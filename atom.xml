<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Artoirus]]></title>
  <link href="http://artori.us/atom.xml" rel="self"/>
  <link href="http://artori.us/"/>
  <updated>2013-05-06T09:33:03+08:00</updated>
  <id>http://artori.us/</id>
  <author>
    <name><![CDATA[Arthur Wang]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[快速使用uwsgi部署]]></title>
    <link href="http://artori.us/easy-deploy-with-uwsgi/"/>
    <updated>2013-04-14T01:02:00+08:00</updated>
    <id>http://artori.us/easy-deploy-with-uwsgi</id>
    <content type="html"><![CDATA[<p>之前尝试在阿里云部署一个bottle.py写的web服务，选择了unbuntu12.04，一穷二白的ubuntu上用uwsgi部署还挺简单的。这里简单记录一下。</p>

<p>先要改一改程序代码，声明一个application</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="n">application</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">app</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后安装uwsgi，demo.py就是修改过的bottle的代码。</p>

<p>这里我遇到了<code>— unavailable modifier requested: 0 --</code>，要安装uwsgi-plugin-python，并且uwsgi启动时候添加<code>--plugin python</code></p>

<p>一些uwsgi的操作看<a href="http://uwsgi-docs.readthedocs.org/en/latest/Management.html">这里</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>apt-get install uwsgi uwsgi-plugin-python
</span><span class='line'>uwsgi --socket :8000 --plugin python --file demo.py --processes 4 --pidfile /tmp/demo.pid --touch-reload<span class="o">=</span>/tmp/restart -d uwsgi.log
</span></code></pre></td></tr></table></div></figure>


<p>安装nginx</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>apt-get install libpcre3 libpcre3-dbg libpcre3-dev
</span><span class='line'>apt-get install zlib1g zlib1g-dbg zlib1g-dev
</span><span class='line'>apt-get install make
</span><span class='line'><span class="nb">cd</span> /path/to/nginx
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>最后配置nginx。默认安装路径在<code>/usr/local/nginx/conf/nginx.conf</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">server</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">listen</span>       <span class="mi">80</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">server_name</span>  <span class="nx">demo</span><span class="p">.</span><span class="nx">artori</span><span class="p">.</span><span class="nx">us</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">location</span> <span class="o">/</span><span class="kr">static</span><span class="o">/</span> <span class="p">{</span> <span class="nx">alias</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">demo</span><span class="o">/</span><span class="kr">static</span><span class="o">/</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">uwsgi_pass</span>      <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">8000</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">include</span>         <span class="nx">uwsgi_params</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>自此搞定</p>

<p>via:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/10748108/nginx-uwsgi-unavailable-modifier-requested-0">http://stackoverflow.com/questions/10748108/nginx-uwsgi-unavailable-modifier-requested-0</a></li>
<li><a href="http://lists.unbit.it/pipermail/uwsgi/2011-November/002923.html">http://lists.unbit.it/pipermail/uwsgi/2011-November/002923.html</a></li>
<li><a href="http://aaronsnow.tumblr.com/post/11560674160/nginx-uwsgi-bottle-py">http://aaronsnow.tumblr.com/post/11560674160/nginx-uwsgi-bottle-py</a></li>
<li><a href="https://groups.google.com/forum/?fromgroups=#!topic/bottlepy/wRfgm4obLXk">https://groups.google.com/forum/?fromgroups=#!topic/bottlepy/wRfgm4obLXk</a></li>
<li><a href="http://blog.felixc.at/2011/01/ubuntu-uwsgi-nginx-bottle-configuration/">http://blog.felixc.at/2011/01/ubuntu-uwsgi-nginx-bottle-configuration/</a></li>
<li><a href="http://apt-blog.net/moinmoin-on-nginx-via-fastcgi-and-uwgi">http://apt-blog.net/moinmoin-on-nginx-via-fastcgi-and-uwgi</a></li>
<li><a href="http://down.chinaz.com/server/201112/1467_1.htm">http://down.chinaz.com/server/201112/1467_1.htm</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[UIWebView加载本地资源]]></title>
    <link href="http://artori.us/uiwebview-load-local-javascript/"/>
    <updated>2013-03-27T18:19:00+08:00</updated>
    <id>http://artori.us/uiwebview-load-local-javascript</id>
    <content type="html"><![CDATA[<p>作为一个不会javascript只会jQuery的程序员，我在做<a href="https://github.com/Arthraim/objs">Objective-c和HTML5页面交互的demo</a>的时候需要HTML至少依赖一个jQuery，放在本地咋整？</p>

<h2>创建UIWebView的时候</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">_webView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIWebView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)];</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">htmlFile</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource:</span><span class="s">@&quot;index&quot;</span> <span class="nl">ofType:</span><span class="s">@&quot;html&quot;</span><span class="p">];</span>
</span><span class='line'><span class="n">NSString</span><span class="o">*</span> <span class="n">htmlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithContentsOfFile:</span><span class="n">htmlFile</span> <span class="nl">encoding:</span><span class="n">NSUTF8StringEncoding</span> <span class="nl">error:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="n">bundlePath</span><span class="p">];</span>
</span><span class='line'><span class="n">NSURL</span> <span class="o">*</span><span class="n">baseURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">fileURLWithPath:</span><span class="n">path</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">_webView</span> <span class="nl">loadHTMLString:</span><span class="n">htmlString</span> <span class="nl">baseURL:</span><span class="n">baseURL</span><span class="p">];</span>
</span><span class='line'><span class="c1">// 把baseURL知道bundle的Url，就能调用bundle里的其他文件了，图片音乐什么的</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_webView</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">_webView</span> <span class="n">release</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>添加.js文件的时候</h2>

<p>添加js文件有点特殊，xcode会以为js是可以编译的代码。要在Xcode的target里，把.js文件从 &#8220;Compile Sources&#8221; 移到 &#8220;Copy Bundle Resources&#8221; .</p>

<h2>写HTML的时候</h2>

<p>可以直接写相对路径了。<code>&lt;script src="jquery.min.js"&gt;&lt;/script&gt;</code></p>

<p><strong>题外话1</strong>: 有个基友要做一个HTML5播放视频的东东，想把视频缓存到本地，但是UIWebView无视HTML5 mainifest里指定的音频视频文件，还有5M的限制。其实也可以存下来本地加载撒。</p>

<p><strong>题外话2</strong>: objc可以用stringByEvaluatingJavaScriptFromString:在webview里执行脚本。js要调用objective-c就比较麻烦。iOS可行的办法是利用custom URL scheme，跳转到应用之后应用或从path或从querystring来判断js要调用什么类什么方法，比较蛋疼。最理想的方式应该是<a href="https://developer.apple.com/library/mac/#documentation/AppleApplications/Conceptual/SafariJSProgTopics/Tasks/ObjCFromJavaScript.html">safari插件支持的方式</a>，可惜iOS没有。</p>

<p>via:</p>

<ul>
<li><a href="https://devforums.apple.com/message/32282">https://devforums.apple.com/message/32282</a></li>
<li><a href="http://mentormate.com/blog/iphone-uiwebview-class-local-css-javascript-resources/">http://mentormate.com/blog/iphone-uiwebview-class-local-css-javascript-resources/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Arthur的2012总结]]></title>
    <link href="http://artori.us/arthur-s-2012-summary/"/>
    <updated>2013-03-15T13:27:00+08:00</updated>
    <id>http://artori.us/arthur-s-2012-summary</id>
    <content type="html"><![CDATA[<p>我觉得这篇2012年总结如果今天不写估计我这辈子都不会写了。2012的末日没有如期而至，以至于写2012年末总结的计划不得不又被提上日程了。</p>

<p>2012年总的来说发生的事情不算多，但是心态变了很多。</p>

<p>博客几乎没怎么折腾，偶尔写了几篇文章。换了octopress。换完博客系统的时候倒是热情高涨把evernote里攒下的素材写了一堆。不过现在又瞬间消极怠工了。</p>

<h3>dev</h3>

<p>今年主要是iOS开发结结实实的盖了几层楼，从之前搭搭积木的阶段，终于到了可以自己造轮子的程度了。完成了几个公司里的产品、项目。现在正在给自己做一个简单的app，买了idp，打算最后把这个应用弄到appstore上，虽然很多人不看好，不过我的初衷也只是做着玩，才没有改变世界的伟大志向呢。</p>

<p>另外因为参与了一个微博应用开发，所以对python、bottle.py、uwsgi都熟悉了不少，之前提到的那个app，以及接下来要说的小玩具的服务端，也都是用bottle和mongodb架起来的，不过VPS能力有限部署的时候还是用了passenger wsgi。</p>

<p>说的小玩具是一个arduino做的小东西，其实就是按一下按钮发一条微博，把它当作门铃来用的话就可以知道家里有没有人按门铃了，虽然知道了也没办法进一步才去什么错失。。。 关于这个东西欢迎关注微博@<a href="http://weibo.com/micbell">阳哥的门铃</a></p>

<h3>life</h3>

<p>依然在魔都打拼，因为之前公司搬到杨浦，所以也住到杨浦来了，和好基友@lionelzhang 好基友@luosky 同居了，住在复旦大学附近，欢迎来做客，做客前记得联系，我好搞下卫生。</p>

<p>10月份的时候正式跳槽了，离开之前的人间网、爱折客，从创业公司来到了一家金融企业。新的工作新的环境，包括换工作这件事情本身，在我内心起了不少化学变化。说实话这个决定让我失去了不少珍惜的甚至引以为傲的东西，当然也感受到了很多期待之内期待之外的新东西。</p>

<p>要说今年印象深刻的好玩经历。十一的时候租了一辆车一路疾行500公里路去参加一个同事的婚礼，吃过晚饭出发，到了那里的时候已经是后半夜了。作为一个今年换了10年期驾照的「老司机」来说，第一次开这样的远门是不是太水了一点。在台州的时候还出了第一次车祸哦。。。</p>

<p>另一个大事就是欧洲杯，不被看好的意大利居然一路杀进决赛。决赛是转成跑到宁波去看的，不过输的也太难看了一点吧。</p>

<h3>diagram</h3>

<p>好吧最后是去过的地方、看过的书、看过的电影。</p>

<p><a href="http://artori.us/images/uploads/octo/2012_places.png"><img src="http://artori.us/images/uploads/octo/2012_places.png" alt="" /></a></p>

<p><a href="http://artori.us/images/uploads/octo/2012_books.png"><img src="http://artori.us/images/uploads/octo/2012_books.png" alt="" /></a></p>

<p><a href="http://artori.us/images/uploads/octo/2012_movies.png"><img src="http://artori.us/images/uploads/octo/2012_movies.png" alt="" /></a></p>

<p>2013加油。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[bottle直接返回pymongo查询结果]]></title>
    <link href="http://artori.us/bottle-autojson-with-pymongo/"/>
    <updated>2012-12-19T10:32:00+08:00</updated>
    <id>http://artori.us/bottle-autojson-with-pymongo</id>
    <content type="html"><![CDATA[<p>以前提到过<a href="http://artori.us/bottle-i-love-this-framework/">bottle</a>，也写过在<a href="http://artori.us/use-mongodb-with-django/">django里使用pymongo</a>，这次是在bottle里用pymongo。</p>

<p>bottle有类似ROR的一些特性，比如处理请求的时候直接return一个字典，框架会自动把它parse成json（autojson）。</p>

<p>我是想偷个懒来着，把代码写成了下面这样。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@get</span><span class="p">(</span><span class="s">&#39;/api/today&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">api_today</span><span class="p">():</span>
</span><span class='line'>    <span class="n">udid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;udid&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">&#39;udid&#39;</span><span class="p">:</span><span class="n">udid</span><span class="p">,</span> <span class="s">&#39;date&#39;</span><span class="p">:</span><span class="n">today</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>这会有问题，因为find_one返回的bson没办法直接parse。伟大的发明都是在偷懒的时候诞生的，看起来我要做的事情也很简单，只要能让我改一改parser就行了。</p>

<ol>
<li>写一个dump方法替换原来JSONPlugin里的</li>
<li>设置Bottle app的autojson为False。<code>Bottle(autojson=False)</code></li>
<li>把有自己dump方法的JSONPlugin给install到app里</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="k">class</span> <span class="nc">MongoEncoder</span><span class="p">(</span><span class="n">JSONEncoder</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">mongo_dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># convert all iterables to lists</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># convert cursors to lists</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">Cursor</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># convert ObjectId to string</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bson</span><span class="o">.</span><span class="n">objectid</span><span class="o">.</span><span class="n">ObjectId</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># dereference DBRef</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bson</span><span class="o">.</span><span class="n">dbref</span><span class="o">.</span><span class="n">DBRef</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">dereference</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="c"># db is the incetance database</span>
</span><span class='line'>        <span class="c"># convert dates to strings</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">app</span><span class="p">()</span>
</span><span class='line'><span class="n">app</span><span class="o">.</span><span class="n">autojson</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'><span class="n">m_encoder</span> <span class="o">=</span> <span class="n">MongoEncoder</span><span class="p">()</span>
</span><span class='line'><span class="n">app</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">JSONPlugin</span><span class="p">(</span><span class="n">json_dumps</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">dumps</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">m_encoder</span><span class="o">.</span><span class="n">mongo_dumps</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>via:</p>

<ul>
<li><a href="https://github.com/defnull/bottle/issues/287">https://github.com/defnull/bottle/issues/287</a></li>
<li><a href="https://gist.github.com/2779820">https://gist.github.com/2779820</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[异或]]></title>
    <link href="http://artori.us/exclusive-or/"/>
    <updated>2012-12-13T12:36:00+08:00</updated>
    <id>http://artori.us/exclusive-or</id>
    <content type="html"><![CDATA[<p>不介绍什么是异或了，有人叫半加、数学系的叫按位模2加</p>

<p>下文用得到的一些简单的性质</p>

<ul>
<li><p><code>x^0 = x</code> 且 <code>x^x = 0</code></p></li>
<li><p>交换律：<code>x^y = y^x</code></p></li>
<li><p>结合律：<code>(x^y)^z = x^(y^z)</code></p></li>
<li><p>自反性：<code>x^y^y = x</code></p></li>
</ul>


<p>下面是几个小题目，可以用异或解决，挺有技巧性</p>

<h2>交换两个数ab</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span>
</span></code></pre></td></tr></table></div></figure>


<p>有意思的是搜索其他异或例子的时候，发现了<a href="http://blog.chinaunix.net/uid-1844931-id-3034714.html">这篇</a>文章，文章里实现了一个异或交换的算法，和本文主题无关，不过很有意思，函数更多的时候应该只操作值而不是变量。</p>

<p><strong>UPDATE_2013-05-06</strong>: 这个，看到云风写了一个利用这个特性做的<a href="http://blog.codingnow.com/2013/05/xor_linked_list.html">双向链表</a>，挺好玩，忍不住写过来。</p>

<h2>A集合里拿掉数x得到B集合，求x</h2>

<p>令<code>XOR(X)</code>表示将X集合内所有的数做异或</p>

<p><code>XOR(B)^XOR(A) = XOR(B)^XOR(B)^x = 0^x = x</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'><span class="n">B</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="o">[</span><span class="mi">1234</span><span class="o">]</span>
</span><span class='line'><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:^</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">x</span> <span class="c1">#1234</span>
</span></code></pre></td></tr></table></div></figure>


<p>via: <a href="http://www.javaeye.com/topic/420487">http://www.javaeye.com/topic/420487</a></p>

<h2>A集合里拿掉数x、y得到B集合，求x和y</h2>

<p>首先按上一个的办法可以推导出<code>xor(A)^xor(B) = xor(B)^xor(B)^x^y = 0^x^y = x^y</code></p>

<p><code>x^y</code>的二进制结果，第n位为1，说明x和y的第n位不相同</p>

<p>根据第n位是否为0把A里所有的数分成A1和A0两个数组（A1里的数的二进制第n位都是1，A0都是0）</p>

<p>A1和A0应该各包含了a或者b（这样第n位才能异或出1）</p>

<p>同理可以把B分成B1和B0两个数组</p>

<p>可以得到第一个数 <code>x = A1^B1</code></p>

<p>第二个数可以<code>y = A0^B0</code>，当然也可以用<code>x^y^x</code>求得</p>

<p>另外如果<code>x^y</code>为0，即<code>x == y</code>，令<code>SUM(X)</code>为X集合内所有数求和</p>

<p><code>(SUM(A) - SUM(B)) / 2 = x</code></p>

<p>via: <a href="http://blog.chinaunix.net/uid-12453618-id-2935334.html">http://blog.chinaunix.net/uid-12453618-id-2935334.html</a></p>

<h2>集合A里只有数x出现1次，其余数全都重复出现2次，求x</h2>

<p><code>xor(A) = x^y^y^…^z^z = x^(y^y^…^z^z) = x^0 = x</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:^</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>集合A里只有数x出现1次，其余数全都重复出现3次，求x</h2>

<p>xor的本质相当于“按位模2加”（adding modulo 2），令p1,p2…pn为布尔值，true为1、false为0，(+)表示异或操作。</p>

<p><code>p1 (+) p2 (+) ... (+) pn == ( p1 + p2 + ... + pn ) % 2</code></p>

<p>所以只需要实现按位模3加</p>

<p><code>( p1 + p2 + ... + pn ) % 3</code></p>

<p>将集合中所有数二进制表示的同一位的0或1相加，最终的和对3去摸，得到的数即是x</p>

<p>如 <code>A = {5, 7, 7, 7}</code>，二进制表示两个数</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="mi">101</span>
</span><span class='line'>  <span class="mi">111</span>
</span><span class='line'>  <span class="mi">111</span>
</span><span class='line'><span class="o">+</span> <span class="mi">111</span>
</span><span class='line'><span class="o">------</span>
</span><span class='line'>  <span class="mi">434</span>
</span><span class='line'><span class="sx">%  </span> <span class="mi">3</span>
</span><span class='line'><span class="o">------</span>
</span><span class='line'>  <span class="mi">101</span>
</span></code></pre></td></tr></table></div></figure>


<p>但愿这坨东西能让人看懂</p>

<p>via: <a href="http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/BitOp/xor.html">http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/BitOp/xor.html</a></p>

<h2>没有<code>^</code>操作时候实现异或，只用<code>&amp;</code>与 <code>|</code>或 <code>~</code>非</h2>

<p>这里的转换有很多，比如下面这个</p>

<p><code>x ^ y == (~x &amp; y) | (x &amp; ~y)</code></p>

<p>具体查看<a href="http://en.wikipedia.org/wiki/Exclusive_or">维基百科</a> 《Equivalencies, elimination, and introduction》部分，各种公式</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xcode优化过的PNG]]></title>
    <link href="http://artori.us/optimized-png-in-xcode/"/>
    <updated>2012-12-12T00:07:00+08:00</updated>
    <id>http://artori.us/optimized-png-in-xcode</id>
    <content type="html"><![CDATA[<p>开始做iOS应用就有一个“公理”，<strong>图片素材要使用png格式</strong>，至于公理是怎么形成的完全不知道，只是听说在官方文档里提到过一句：苹果会对png进行优化。</p>

<p>为什么优化？谁优化的？什么时候优化的？怎么优化的？</p>

<p>和所有的魔术一样，说穿了就不好玩了。一切的根源是iPhone的显存。iPhone的vRAM在存放单个像素的颜色的时候，并不是按照传统的“红-绿-蓝”这样的顺序排列的，而是“蓝-绿-红”，即我们常说的RGB，在iPhone的显存里是BGR。并且，没有alpha通道。</p>

<p>另一边，png格式按照“红-绿-蓝”的顺序描述颜色，并且支持alpha通道的半透明，RGBA四个通道各占1个字节。</p>

<ul>
<li>为什么优化？
因为一边RGB一边BGR，一边有alpha一边没有alpha。</li>
<li>谁优化的？
文章标题已经剧透了，Xcode优化的。</li>
<li>什么时候优化的？
Xcode在编译时，会对png资源进行优化。</li>
<li>怎么优化的？
优化做了两件事：

<ol>
<li>把png里所有的RGB颜色转成BGR顺序</li>
<li>把png里所有的alpha通道先和RGB三通道先乘好（比如R:1 G:1 B:1 A:0.5的颜色直接转成 R:0.5 G:0.5 B:0.5）</li>
</ol>
</li>
</ul>


<p>这样最终设备在运行时渲染这些颜色的时候，不需要任何处理，一个汇编语句就把数据丢尽显存里了。</p>

<p>PS: <a href="http://developer.apple.com/library/ios/#qa/qa1681/_index.html">这里</a>还有一个手动转换，和还原的办法</p>

<p>via: <a href="http://iphonedevelopment.blogspot.jp/2008/10/iphone-optimized-pngs.html">http://iphonedevelopment.blogspot.jp/2008/10/iphone-optimized-pngs.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从wordpress搬到octopress]]></title>
    <link href="http://artori.us/migrated-from-wordpress-to-octopress/"/>
    <updated>2012-12-11T23:12:00+08:00</updated>
    <id>http://artori.us/migrated-from-wordpress-to-octopress</id>
    <content type="html"><![CDATA[<p>断断续续把wordpress转换到octopress上了。这是z-blog转到wordpress之后第二次更换博客系统了，octopress很酷，markdown的数据复用、搬家、存档都比lamp的wordpress轻便的多。</p>

<p>从导出wordpress数据库，转换为markdown，部署到github，搬图片文件，转换评论，磨磨蹭蹭的前前后后大约拖延了有两周，到今天终于把域名解析给换到这里来了。</p>

<p>最头疼的是转换文章的脚本不见得可靠，老文章的格式乱七八糟需要一篇一篇手动去修正，我现在做了一半，至少保证最新的大约3/5的文章是修改过的友好的格式。</p>

<p>很久没有更新博客，evernote的博客素材已经攒了一大堆，有空一篇一篇写出来吧。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2012欧洲杯Google,iCal,Outlook日历]]></title>
    <link href="http://artori.us/euro-2012-google-calendar-or-outlook-calendar/"/>
    <updated>2012-06-08T23:10:57+08:00</updated>
    <id>http://artori.us/euro-2012-google-calendar-or-outlook-calendar</id>
    <content type="html"><![CDATA[<p>今晚欧洲杯就开打了。在Live Calendar里导入了这个日历之后，同步到Windows Phone上很爽。</p>

<ol>
<li><p>在Google Calendar订阅好友的日历：euro2012calendar@gmail.com</p></li>
<li><p>直接访问<a href="https://www.google.com/calendar/embed?src=euro2012calendar%40gmail.com&amp;ctz=America/Denver">这个地址</a>，在最下面添加到Google Calendar</p></li>
<li><p>下载<a href="https://www.google.com/calendar/ical/euro2012calendar%40gmail.com/public/basic.ics">这个ics文件</a>导入到outlook, live calendar或iCal、iPhone等</p></li>
</ol>


<p><a href="http://artori.us/euro-2012-google-calendar-or-outlook-calendar/screen-shot-2012-06-08-at-3-08-39-pm/"><img src="http://artori.us/images/uploads/wp/Screen-Shot-2012-06-08-at-3.08.39-PM-500x298.png" alt="" /></a></p>

<p>原文地址：<a href="http://www.eurojoe.com/2012/06/01/euro-2012-google-calendar/">http://www.eurojoe.com/2012/06/01/euro-2012-google-calendar/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[git修剪分支]]></title>
    <link href="http://artori.us/git-prune-branch/"/>
    <updated>2012-03-02T08:07:32+08:00</updated>
    <id>http://artori.us/git-prune-branch</id>
    <content type="html"><![CDATA[<p>项目运转的久了，很多个人的战略的bugfix的feature的分支一堆一堆，今天忍不住想清理一些已经被合并的分支。这里用到了几个相关的git命令。</p>

<ul>
<li><p><code>git branch</code> 可以查看本地有的分支，当前分支之前有个*。</p></li>
<li><p><code>git branch -r</code> 查看所有远程的分支（不代表远程还有的分支）</p></li>
<li><p><code>git branch -a --color</code> 查看所有分支（<code>--color</code>加颜色，绿色是tracking的）</p></li>
<li><p><code>git branch -d TAG</code> 删除本地分支，如果这个分支有没有合并的提交，git会提示你改用 <code>-D</code> 强制删除（或干脆别删除！）</p></li>
<li><p><code>git push REMOTE :TAG</code> 删除远程REMOTE（比如一般叫origin）分支，注意分支名前加冒号</p></li>
<li><p><code>git remote prune REMOTE</code> 这个指令比较特殊，如果你在A仓库上<code>git fetch</code>过，在B仓库用上一条命令删除了远程分支，那么A仓库里 <code>git branch -r</code> 还是可以看到已经删掉的分支。这个时候可以用这个命令修剪这些分支。</p></li>
<li><p><code>git prune</code> 在本地也可以使用，不过作用我还真不清楚，官方用推荐用 <code>git gc</code></p></li>
</ul>


<p>记录下，git真的很萌的你们不要黑他。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac OS 10.7.3用xcode提交二进制文件验证失败]]></title>
    <link href="http://artori.us/mac-os-10-7-3-breaks-xcode-binary-validation/"/>
    <updated>2012-02-13T04:27:59+08:00</updated>
    <id>http://artori.us/mac-os-10-7-3-breaks-xcode-binary-validation</id>
    <content type="html"><![CDATA[<p>近日在提交一个app的时候发生了奇怪的错误。错误如下：</p>

<p><a href="http://artori.us/mac-os-10-7-3-breaks-xcode-binary-validation/icon-dimensions-dont-meet-the-size-requirements/"><img src="http://artori.us/images/uploads/wp/icon-dimensions-dont-meet-the-size-requirements.png" alt="" /></a></p>

<blockquote><p>iPhone/iPod Touch: Icon.png: icon dimensions (0 x 0) don&#8217;t meet the size requirements. The icon file must be 57x57 pixels, in .png format</p></blockquote>

<p>我使用的Xcode版本是4.2.1，其实一下子也懵了完全没头绪。我第一时间当然是以为我的Icon.png真的出问题了，因为偶尔我会自己用一个叫做prepo的app来把512的图标转成57像素的，所以我第一时间以为是它的问题。（因为它之前也把比如10k的blabla@2x.png转成了20k的blabla.png）。于是我用Photoshop重新转换了一个图标来试图解决这个错误，结果当然是失败了。</p>

<p>各种Google之后，问题被锁定到了Mac OS 10.7.3这个升级包上，升级了之后是第一次提交二进制文件。<a href="https://devforums.apple.com/message/611733">这个讨论</a>都已经说明了病灶在哪里。</p>

<p>Xcode提交当然还是存在问题，无法通过验证，而且暂时没法解决。但是办法还是有，使用更加原始的Application Loader来上传。于是我打开Application Loader并登陆之后问题又出现了。</p>

<p><a href="http://artori.us/mac-os-10-7-3-breaks-xcode-binary-validation/screen-shot-2012-02-10-at-12-16-13-pm/"><img src="http://artori.us/images/uploads/wp/Screen-Shot-2012-02-10-at-12.16.13-PM.png" alt="" /></a></p>

<p>嗯，自带的版本看来太老了。于是各种Google之后<a href="https://itunesconnect.apple.com/apploader/ApplicationLoader_2.5.1.dmg">新的版本</a>终于还是找到了。使用方法很简单，跟着向导一步一步做（前提是itunes connect上的应用已经waiting for upload状态）直到需要在硬盘选择文件。首先在Xcode里Product -> Build for -> Building for archiving。然后Xcode工程下Products目录，有个 工程名.app，右键Show in finder，在它的上一级目录里找到release版本的app。当然上传前要把它打包成zip文件，application loader不能指定.app。最后完成向导，文件终于上传成功鸟 -。- 然后可以等着review了。</p>

<p><strong>更新：</strong>好吧看到了新说法是只要装好Application Loader 2.5.1，重启xcode，clean工程，重新archive，然后就能通过验证了，不需要真的使用Application Loader上传。 没试过，不一定管用，可以试试看。</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[停用arthraim.cn域名]]></title>
    <link href="http://artori.us/abandon-arthraim-cn/"/>
    <updated>2012-01-06T22:52:15+08:00</updated>
    <id>http://artori.us/abandon-arthraim-cn</id>
    <content type="html"><![CDATA[<p>arthraim.cn的域名又到期了，因为之前的代理被卖到别的地方了所以很烦躁这个域名不要了.cn域名也实在是操蛋的可以。</p>

<p>之前留着也只是为了做一个重定向，现在重定向了一年了搜索引擎什么的也应该反应过来了，所以就不要了吧。</p>

<p>再见arthraim.cn</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Arthur的2011年总结]]></title>
    <link href="http://artori.us/arthur-s-2011-summary/"/>
    <updated>2012-01-01T07:07:29+08:00</updated>
    <id>http://artori.us/arthur-s-2011-summary</id>
    <content type="html"><![CDATA[<p>还有一个小时2011年就过完了，末日年就在眼前。今年博客更新的非常少，当然我没有偷懒，公司从年底上马了新的产品之后我就全身心的投入到了新的工作里去了。</p>

<p>爱折客从去年年底开始慢慢开发到现在整一年，发展迅速，今天年终总结的时候说实话我也觉得很振奋，虽然始终我的兴趣点在social上而爱折客虽然有点像solomo，但是其实是没有social的成分的，所以我承认我并不是那么&#8221;爱&#8221;它。但是到了这个时候看着这个产品我觉得很自豪，我们是一群踏踏实实的童鞋们，没有开复老师呼风唤雨的本事，勤勤恳恳的做业绩，可能并不是很多人看到我们的成绩，但是我们很棒。</p>

<p>技术上，算是真正独立完成了一个web的客户端，初期也并没有存储全部和后面的api交互，后来做着做着后台越做越大mongodb越做越熟。另外转型iOS开发才是这一年真正拼了老命的事情，要感谢公司给我配了台iMac坦率说是动力的源泉，很有压力但是的确是动力。现在自豪的说app store上已经有5个app出自我手啦。因为要偶尔维护api，所以虽然没有系统的学不过接触了ruby on rails，很有魅力！</p>

<p>依然看了很多电影，没有去年多当然。依然看了很少书。动画几乎没看，剧集也是有一集没一集的追。在游戏上花的钱更多了，因为今年掌机换代了，入手了PSVita，也算是5年一次的大开销吧。</p>

<p>希望明年公司蒸蒸日上，希望自己大大进步。2012我来了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows Phone版微博通]]></title>
    <link href="http://artori.us/windows-phone-wbt/"/>
    <updated>2011-12-12T00:53:41+08:00</updated>
    <id>http://artori.us/windows-phone-wbt</id>
    <content type="html"><![CDATA[<p>很久没有写博客了，已经有友联的童鞋抱怨了，最近这段时间很忙，几乎下班就没心情做自己的事情了。话说最近入手了一台WP7，三星focus，白菜价，手机丢了所以来不及等Nokia Lumia 800了，很急就入手了。话说这不是重点，我手痒然后卸掉了WP7sdk的beta2，装上了新的7.1，小玩了一下。</p>

<p>话说其实给WP7写应用还真的蛮好玩的，事实上marketplace实际上也比我想象的要热闹一点，所以还蛮有动力写点东西的，最近在公司写iOS的app，每天都是objective-c，捡起了以前的C#真是一下子觉得好厉害，一个天一个地啊，终于不用自己retain, release了。</p>

<p>对了写了两段还是没有说到重点，因为重点就一句话，在熟悉WP7的开发，所以写了个微博通的客户端，好吧只是调用api发个post的请求而已很简单，主要是自己熟悉一下。</p>

<p>对了东西已经开源了在<a href="https://github.com/Arthraim/WbtoMongo">这里</a></p>

<p>那写到这里就写完了。感叹一下，visual studio真的不错，现在.net的包管理也很方便！现在dotnet我已经算是局外人了，所以不嘴贫了 -。-</p>

<p>以上</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ruby好可怕]]></title>
    <link href="http://artori.us/ruby-is-horribl/"/>
    <updated>2011-09-11T20:40:56+08:00</updated>
    <id>http://artori.us/ruby-is-horribl</id>
    <content type="html"><![CDATA[<p>接触ruby时间不长，用的机会就更少了，所以偶尔用一下的时候难免还要去翻翻文档什么的。维护某个后台的时候，有个随机输出的需求，所以我写了下面这样一段代码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="n">ver</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span> <span class="o">==</span> <span class="kp">nil</span> <span class="p">?</span> <span class="s1">&#39;i&#39;</span> <span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@preview_items</span> <span class="o">=</span> <span class="no">MyItem</span><span class="o">.</span><span class="n">where</span><span class="p">({</span><span class="ss">:version</span> <span class="o">=&gt;</span> <span class="n">ver</span><span class="p">,</span> <span class="ss">:order</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="o">[</span><span class="ss">:order</span><span class="p">,</span> <span class="ss">:desc</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>  <span class="vi">@preview_items</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</span><span class='line'>    <span class="n">order</span> <span class="o">=</span> <span class="n">item</span><span class="o">[</span><span class="s1">&#39;order&#39;</span><span class="o">]</span>
</span><span class='line'>    <span class="n">map</span><span class="o">[</span><span class="n">order</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">map</span><span class="o">[</span><span class="n">order</span><span class="o">]</span> <span class="o">==</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">map</span><span class="o">[</span><span class="n">order</span><span class="o">].</span><span class="n">push</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@json_items</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">map</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>    <span class="n">arr</span> <span class="o">=</span> <span class="n">map</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>      <span class="vi">@json_items</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="vi">@json_items</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">render</span> <span class="n">json</span><span class="p">:</span> <span class="vi">@json_items</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:callback</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>rails某个模型的index页面，具体做了什么呢？大概是四件事情：</p>

<ol>
<li><p>取参数version</p></li>
<li><p>在数据库查询该version并且order字段大于0的数据，根据order字段倒叙排列（数据库是mongodb，driver用mongoid）</p></li>
<li><p>遍历查询的结果建立一张以order为key，相应order的实体数组为value的表</p></li>
<li><p>遍历3中的表，每个order的数组中随机抽取一个元素作为这个order的唯一值</p></li>
</ol>


<p>最后把获取的新数据render。</p>

<p>看起来很满足什么的，就提交代码了。之后同事部署前，看了看这里的更新，然后最终把代码完全改掉了。只用了一行 =。=</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="vi">@json_items</span> <span class="o">=</span> <span class="no">MyItem</span><span class="o">.</span><span class="n">where</span><span class="p">({</span><span class="ss">:version</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="ss">:order</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="o">[</span><span class="ss">:order</span><span class="p">,</span> <span class="ss">:desc</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:order</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="o">.</span><span class="n">sample</span><span class="p">}</span>
</span><span class='line'>  <span class="n">render</span> <span class="n">json</span><span class="p">:</span> <span class="vi">@json_items</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:callback</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>做的事情是完全一样的。</p>

<ol>
<li><p>他先看了取参数，不用三元，直接 || 一个默认值</p></li>
<li><p>然后他把第4步中的取随机的部分改了，因为数组中随机取一个元素，ruby直接有sample方法</p></li>
<li><p>然后他又觉得第四步可以更简单的调用hash的map方法，映射成另一个value = value.sample的map</p></li>
<li><p>最后他吃了顿中饭回来灵光一闪，终于发现第三步做的就是一个group_by的事情，ruby可以做这个事情</p></li>
</ol>


<p>于是，除了查询不变，所有的逻辑全部调用了ruby现成的方法完成了！哥落伍了…… 越发觉得ruby好强大。</p>

<p>BTW，帮我改代码的是@niedhui</p>

<p>以上……</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NoMethodError: undefined method `specifications' ...]]></title>
    <link href="http://artori.us/nomethoderror-undefined-method-specifications/"/>
    <updated>2011-07-21T05:11:17+08:00</updated>
    <id>http://artori.us/nomethoderror-undefined-method-specifications</id>
    <content type="html"><![CDATA[<p>今天在和同事说，我最喜欢写这样的文章了，很多人会碰到的异常，而且没有什么中文资料，可以给搜索引擎个好排名（喂你心机好重。好吧其实我的想法很伟大的哦，我是给以后会遇到一样问题的你造福哦~</p>

<p>重新搭新环境，先装了rvm，然后装上gem，用gem装了rails。之后呢问题就出来，尝试用bundle exec rake db:seeds的时候会出错，加上&#8211;track参数一看大概是这样子。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>undefined method `specifications' for "/Users/arthraim/.rvm/gems/ruby-1.9.2-p290":String</span></code></pre></td></tr></table></div></figure>


<p>好像后面也不是特别重要了，只是这个问题比较费解，之前同事好像也遇到过。去Google了一下，居然是gem版本太高的关系，要把gem降级到早一些的版本。不想深究下去了，就说一下解决的办法好了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem update --system 1.7.2</span></code></pre></td></tr></table></div></figure>


<p>之前我的版本是1.8.5，虽然不知道具体什么情况，不过1.7.2就可以了。话说gem update到老版本的方法好神奇 -。-</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RubyGems升级造成yaml parse错误]]></title>
    <link href="http://artori.us/the-update-of-rubygems-causes-yaml-parsing-problem/"/>
    <updated>2011-06-29T11:10:44+08:00</updated>
    <id>http://artori.us/the-update-of-rubygems-causes-yaml-parsing-problem</id>
    <content type="html"><![CDATA[<p>遇到个很蛋疼的问题，mongoid的配置文件（一个YAML）文件引发了下面这个错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db_name must be a string or symbol
</span><span class='line'>...MONGOID_PATH/lib/mongo/util/support.rb:50:in `validate_db_name'</span></code></pre></td></tr></table></div></figure>


<p>Google到<a href="http://cstrahan.com/2011/05/14/mongoid-yaml-rails-conflict.html">这里</a>，知道原因是RubyGem v1.5.0开始把默认的yaml parser从syck改成了psych。</p>

<p>解决方法一当然是改你的yaml让它可以被parse，如果需要使用之前的parser，那要在config/environment.rb中加上以下两行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'yaml'
</span><span class='line'>YAML::ENGINE.yamler= 'syck'</span></code></pre></td></tr></table></div></figure>


<p>话说这好像是第一次写ruby/rails的文章，刚刚玩了两三个星期~</p>

<p>以上</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[三大游戏主机厂商2011年E3展前发布会]]></title>
    <link href="http://artori.us/2011-e3-press-conferences/"/>
    <updated>2011-06-08T09:38:41+08:00</updated>
    <id>http://artori.us/2011-e3-press-conferences</id>
    <content type="html"><![CDATA[<p>在北京时间昨天0点30分，今天昨天上8点和今天凌晨0点，微软、索尼、任天堂三大游戏主机厂商的E3展前发布会依次召开。集结第一方第三方各种游戏阵容及对硬件平台的更新换代，三大厂商都给今年E3注入了一针兴奋剂，注定是一个同样不平凡的E3将要开始。</p>

<p>微软的展前发布会是最平淡的，大量的KINECT游戏介绍、XBOX LIVE的各种升级，以及其他CU（core user核心玩家）的软件，但是惟独缺少了新的硬件，无论是新外设还是X720，更别说微软掌机，一样都没有出现。唯一的亮点就是压轴的HALO4，这也是唯一让我骂娘的牛B消息。</p>

<p><a href="http://artori.us/2011-e3-press-conferences/2011_e3_microsoft/"><img src="http://artori.us/images/uploads/wp/2011_e3_microsoft-500x281.jpg" alt="" /></a></p>

<p>索尼的展前发布会之前，NGP已经在各种场合出现过了，伴随着PSN故障的道歉，各种软件的介绍，等到平井一夫上台的时候，大家知道今年的重头戏来了 &#8212;- NGP。和之前传闻一样，NGP的真名的确是Playstation Vita（生命）。当然PSV的硬件规格早就不是秘密，不过发售计划和价格才是人们关注的焦点，接近PS3技能的掌机，几乎应该是不敢想象的昂贵。不过事实证明索尼赢了，&#8221;业界最后的良心&#8221;是大家的评论，PSV售价24800日元（249.9美元），哪怕是3DS也要25000日元，索尼这个价格实在是太震撼了！</p>

<p>另外索尼公布的3D电视利用LL/RR的眼镜原理可以让两名玩家看到完全不同的画面，这样一来夫妻两个盯着同一个屏幕一个看电视一个玩游戏的梦想不远了！唯一的遗憾是两个人都要带着有色眼镜看电视了。</p>

<p><a href="http://artori.us/2011-e3-press-conferences/2011_e3_sony/"><img src="http://artori.us/images/uploads/wp/2011_e3_sony-500x280.jpg" alt="" /></a></p>

<p>十来分钟前结束的任天堂展前发布会应该是最精彩的，在展前沸沸扬扬的project cafe新主机，以及后来爆出来的控制器上会有6寸液晶屏，这下都真相大白了。任氏一样用第一方的软件砸，然后第三方的阵容也的确是牛X。最震撼的是在发布会的最后一项，大肆介绍了新一代的主机WiiU。正是之前的控制器。但是这个东西很神奇，虽然猩猩和岩田聪都称之为：new controller。但EA和其他第三方纷纷称其：new platform, new console或new system。究竟只是一个wii的控制器还是一台新的家用机掌机合体，大家都应该明白了，毕竟wii是不支持HD的，其实project cafe的主机和控制器之和就是今天的wiiU，可不是只有一个控制器而已哦~</p>

<p><a href="http://artori.us/2011-e3-press-conferences/2011_e3_nintendo/"><img src="http://artori.us/images/uploads/wp/2011_e3_nintendo-500x281.png" alt="" /></a></p>

<p>E3每天都在恢复往日的气息，伴随着3DS/KINECT甚至NGP/WIIU的出现，E3也真的回来了，复苏了。势必明年的E3会有PS4 X720甚至WII2的出现，让我们好好欣赏今年的E3，并期待它有更大的发展吧~</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[java语言oauth库scribe-java支持新浪微博]]></title>
    <link href="http://artori.us/java-oauth-lib-scribe-java-start-supporting-weibo/"/>
    <updated>2011-06-04T07:41:22+08:00</updated>
    <id>http://artori.us/java-oauth-lib-scribe-java-start-supporting-weibo</id>
    <content type="html"><![CDATA[<p>好吧这是一篇蛋疼的文章, 因为本人第一次成功pull request所以比较鸡冻. <a href="https://github.com/fernandezpablo85/scribe-java">scribe-java</a>是一个java语言的oauth库, 代码很干净利落很容易扩展而且用起来很方便. 因为<a href="http://artori.us/something-about-oauth/">之前文章</a>提到过的工作, 所以对scribe-java做了<a href="https://github.com/Arthraim/scribe-java">一些改造</a>.</p>

<p>事实上很多改造是因为scribe-java的确还存在一些问题, 比如oauth参数不支持querystring等, 所以改造工作不可避免. 不过随着作者非常快速的更新, 现在它已经大大改善了这些方面的功能. 回过头来再看自己的folk, 事实上也完全没有必要了.</p>

<p>当然很希望国内的开发者在pom.xml里写上scribe-java就可以直接支持国内的各个微博, 所以我整理了一下我的分支正式的发起了pull request. 经过几次交流, 最终 新浪微博 / 网易微博 / 搜狐微博 的相关支持已经正式纳入了原作者的版本中得到支持了. 另外我一起提出请求的QQ微博和人人2.0最终因为代码的修改太大, 作者没有采纳(如果你要使用, 可以下载<a href="https://github.com/Arthraim/scribe-java">我的folk</a>.</p>

<p>具体用法欢迎参考<a href="https://github.com/fernandezpablo85/scribe-java/blob/master/src/test/java/org/scribe/examples/SinaWeiboExample.java">这个例子</a> :) 开源是个尝到甜头就像继续下去的工作, 哪怕你的贡献再渺小, 也非常的美好. 让我鸡冻的感谢一下原作者Pablo Fernandez, 来自阿根廷.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[bottle-非常喜欢这个框架]]></title>
    <link href="http://artori.us/bottle-i-love-this-framework/"/>
    <updated>2011-05-30T04:46:07+08:00</updated>
    <id>http://artori.us/bottle-i-love-this-framework</id>
    <content type="html"><![CDATA[<p>大概是我火星了，直到2天前我才知道有bottle这样一个框架。鉴于对自己的翻译能力没有什么信心，就摘抄<a href="http://bottlepy.org">bottle官网</a>上对自己介绍的原文过来吧。</p>

<blockquote><p>Bottle is a fast, simple and lightweight WSGI micro web-framework for Python. It is distributed as a single file module and has no dependencies other than the Python Standard Library.</p></blockquote>

<p>坦率说因为工作中是使用spring的缘故，其实真正用python的web框架机会并不多。相对接触的比较多的是django，无论是工作中还是生活中写点小东西的时候我还是比较愿意使用django，django+mongoengine，可以快速的使用mongodb来做存储，具体就不细说了这不是重点，<a href="http://artori.us/use-mongodb-with-django/">之前的文章</a>中提到过。至于pylons, web.py或者其他的，大概看了一眼文档就没啥特别的感觉就没有深究下去。</p>

<p><a href="http://artori.us/bottle-i-love-this-framework/logo_nav/"><img src="http://artori.us/images/uploads/wp/logo_nav.png" alt="" /></a></p>

<p>今天主角是bottle，早上醒来迷迷糊糊在reader上看了<a href="http://simple-is-better.com/news/detail-292">一个充满印度腔的视频</a>，讲用bottle框架5分钟创建一个wiki。就是这个视频让我对bottle一见钟情。可以看一下官网的helloworld</p>

<p><a href="http://artori.us/bottle-i-love-this-framework/2011-05-29_bottle_hello_world/"><img src="http://artori.us/images/uploads/wp/2011-05-29_bottle_hello_world.png" alt="" /></a></p>

<p>好像做一个restful的东西好轻松的样子，直到我花了2个小时认真的读了他的<a href="http://bottlepy.org/docs/dev/tutorial.html">这一页</a>文档，我才觉得这真的太棒了！搭建一个web应用真的是手到擒来鸟。dict直接输出为json，multipart上传文件直接从request.files里面读取，cookie以及加密的cookie等等偷懒的feature真是不少。</p>

<p>内建的template相对要蛋疼一点，我都没有找到loop，不过支持mako很简单，和内建的用法几乎是一模一样的。</p>

<p>各种给力不多说了，现在自己在写一个用bottle+mongo的应用玩，另外学习的时候写了<a href="https://gist.github.com/994641">一个例子</a>，也传到了github上，愿意的话可以看看，里面有很多让人高兴的地方。如果你和我一样有做一个web应用的冲动，不妨试试看bottle！</p>

<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[随便写写oauth]]></title>
    <link href="http://artori.us/something-about-oauth/"/>
    <updated>2011-04-08T04:12:47+08:00</updated>
    <id>http://artori.us/something-about-oauth</id>
    <content type="html"><![CDATA[<p>最近用到了其他微博的oauth, 起初觉得oauth很烦, 因为文档看了很久很久都没有弄明白怎么回事. 等到初步模到了一些门道之后, 发现其实挺简单的, 因为那是一个标准, 理论上只要支持oauth的网站用一套代码去跑基本上都可以通过. 不过在实际的应用当中我算是领教到了中国互联网的强悍之处. 已经不记得是在什么地方看到一篇文章, 作者一上来第一句话就是 &#8220;从oauth可以看出一个互联网企业的技术力&#8221;, 虽然稍微有些偏激, 但多多少少有值得认同的地方.</p>

<p><strong>我了解的oauth</strong></p>

<p>oauth其实是个认证, 就和HTTP的basic auth一样, 通过认证才能访问HTTP的资源. 之所以需要oauth, 只是为了解决一个问题:&#8221;第三方不获得用户第一方的密码的前提下访问第一方的资源&#8221;, 所以保障用户通信过程中密码不被泄露是其次, 关键更重要的是第三方不会获得用户名和密码.</p>

<p>于是强大的地方就这样显现出来了, 不知道大家有没有看到过新浪微博的xauth, 什么是xauth呢? 我没有去考据究竟xauth是谁的创造, 它几乎搬了大部分oauth的内容, 不过解决了一个什么问题呢? 解决了一个 &#8220;oauth认证必须跳转到第一方去输入密码&#8221; 的问题(美其名曰提升用户体验). 对不起我凌乱了, 第三方是可以得到用户密码的, 那它是不是直接把oauth的第一大feature给OOXX掉了 - - 那basic auth不能满足你么大哥?</p>

<p><strong>各大网站的oauth</strong></p>

<p>因为工作和兴趣双重因素所致(这真是个难得一遇的好事情), 我接触了各个门户的oauth, 首先有个前提就是我用了oauth.net上罗列的某个java的oauth库, 饱受挫折, 经过几周的积累, 我才决定写下这篇文章, 多多少少对后来者有所提示和帮助.</p>

<p><strong>新浪微博</strong></p>

<p>把新浪放在第一家只是因为我第一个做的是新浪微博的oauth, 一上来使用了一个库叫做<a href="http://code.google.com/p/oauth-signpost/">oauth-signpost</a>, 看上去挺不错的样子, 尝试了一下它对Google等国外网站的例子, 我觉得可以用, 于是开始写. 之后马上就遇到了问题, 在申请request_token的过程中, 服务器会返回一个oauth_callback_confirmed的参数, 这个是明确写在oauth 1.0标准中的 (原先的1.0a, 如今已正式merge到了1.0中, 感兴趣的话<a href="http://www.skiyo.cn/2010/08/23/oauth-1-0a-and-1-0/">这里</a>有一篇资料描述了1.0a和早期1.0的差异), 是必须有的, 可是如果你是通过POST方法请求, 那么很抱歉新浪微博是没有提供的. 这显然是一个疏漏. 在新浪微博官方论坛里, 这个问题不止一次的被提到(看<a href="http://forum.open.t.sina.com.cn/read.php?tid=1838">这里</a>, 看<a href="http://forum.open.t.sina.com.cn/read.php?tid=912&amp;ordertype=desc">这里</a>,), 虽然说是 &#8220;近期会加上&#8221; 不过感觉新浪要改应该不会那么敏捷, 所以能做的只有耐心等待和回避这个问题. (虽然不影响正常功能, 不过毕竟人家是标准, signpost就是属于那种按照标准来结果在新浪出错了的牺牲品)</p>

<p>为了回避这个问题, 我改用了<a href="https://github.com/fernandezpablo85/scribe-java">scribe-java</a>这个库. 不过在做新浪微博的时候发现的问题, 好像只有这一个.</p>

<p><strong>网易微博</strong></p>

<p>网易是在我快速尝试了搜狐/豆瓣/腾讯之后成功完成的第二个, 事实上很幸运, 基本上不用改太多的代码就完成了网易的功能. 虽然这样, 并不表示网易就按照标准来, 首先我发现的明显的一个不按照标准的地方是authorization步骤, 它提供了两个接口, 一个是/oauth/authorize, 一个是/oauth/authenticate, 首先我先申明这两个单词我一直搞不清, 不过在网易给oauth的分工中, 它们的工程师是这么定义的: authorize不处理callback, 直接展示verifier的页面; 另一个, authenticate则处理callback. (至于给第二个传oob会怎么样, 有没有返回oauth_callback_confirmed, 我都没有细看了)</p>

<p>另外小提一下, 它在回调你的callback地址的时候, 传的参数名是oauth_token, 不过相信我, 我觉得那是oauth_verifier.</p>

<p><strong>腾讯微博</strong></p>

<p>对腾讯微博(QQ微博)的尝试其实在网易之前, 不过才看了文档我就挂掉了, 因为它不支持header传递oauth参数, 只支持querystring, 虽然的确在oauth协议中写出可以使用querystring, 不过我觉得header比较帅气可不可以啊, 而且我的库不支持querystring啊企鹅大哥 - -</p>

<p>大问题放前面, 后面还有小问题呢. 在请求request_token时传递oauth_callback参数, 因为写测试没用到callback, 所以肯定库会帮我填上oob(out-of-bound), 不过让我很崩溃的是企鹅大爷不高兴了, 给我跳转到了一个这样一个地方: https://open.t.qq.com/oauth_html/oob?oauth_token=xxxxx&amp;oauth_verifier=xxxxxx, 这当然是NOT FOUND, 这是企鹅大哥的地盘, 我不能做主啊.</p>

<p>千辛万苦查到了企鹅大哥的文档里写了这么一句话: <strong>① 用户授权后web应用将会重定向到oauth_callback。当应用为pc客户端或手机客户端应用时，没有回调url(oauth_callback)的概念，此时设置为字符串null即可。字符串&#8221;null&#8221;必须是小写。</strong>爹啊&#8230; 你是我亲爹啊. 不按套路出牌的啊! (<a href="http://open.t.qq.com/bbs/viewthread.php?tid=2352">愤怒的同学</a>显然不止我一个, 而且没人理他)</p>

<p>对了, 今天还发现腾讯微博开发平台的文档修改过了, 不过&#8230;&#8230;&#8230;&#8230;.. 被修改的似乎只有文档而已.</p>

<p><strong>搜狐微博</strong></p>

<p>申请搜狐博客应用的时候填写了一个callback, 不知道是干吗的. 另外看了一些人写的东西, 说搜狐不让传realm. 我用之前的代码跑了一下, 结果报错说signature_invalid, 我想这东西估计不靠谱就先放下去做网易微博了. 今天下午回过头来去再摸了摸搜狐微博, 想不到一下子就跑通了, 可喜可贺, 不知道是不是它最近几天有更新, 还是我第一次的尝试实在太潦草以至于自己出错了错怪了搜狐. 不过搜狐微博的开发文档写的真不怎么样, 相比起来前三家好多了.</p>

<p>还有一个问题是搜狐不理会我的oauth_callback, 除非在authorize的时候传(querystring, 和oauth_token一起传), 不过这应该是oauth 1.0a就改掉的地方, 搜狐大概是没有跟上?</p>

<p><strong>豆瓣</strong></p>

<p>你们知道, 作为一个程序员, 对豆瓣的崇拜之情是难以言表的. 豆瓣的高性能, 以及豆瓣为开源做出的各种贡献都是围城外面的程序员羡慕不已的, 并且把 &#8220;指环王&#8221; 当作文化的豆瓣团队也给我留下了足够美好的印象. 熟悉python的朋友不会不知道simple is better than complex这句话, 用python开发的豆瓣无论如何都让我觉得是simple的典范. 无论如何, 我始终觉得豆瓣是一个技术很棒的企业. 这一切美好的印象只持续到我接触它的oauth之前.</p>

<p>还是先说有点, 豆瓣的oauth文档简介明了, 该说的都说清楚了. 另外豆瓣的错误信息返回的很厚道, 会把服务器拼出来的base string发给你, 让你和自己的好好比较一下, signature错误找起来就方便多了.</p>

<p>不过signature的错误你是永远也不会觉得好办的&#8230; 因为豆瓣太特别了. 在它的basestring里有一个多余的 &#8220;OAuth%2520&#8221; 请求的url之后, 所有参数之前. 百思不得其解这究竟是什么, 难道是历史原因造成的? 总之对于我来说要做的只不过是拼接basestring的时候硬加上去. (至今仍然希望高手解答, 之前的oauth版本里是这样的?)</p>

<p>解决了这个问题还没完, 还有问题. 我尝试使用拿回来的access_token去访问资源, 又报signature错误了. 具体问题我在豆瓣的<a href="http://www.douban.com/group/topic/18667209/">这个帖子</a>里详细描述了, 不过还没有得到答案. 在这个请求中我要不要加上oauth_callback_url这个参数是一回事, 它是不是参加排序又是另外一回事不是么? (至少不该是签名错误吧)</p>

<p>另外还有一个小问题, 豆瓣返回oauth_token=xxx&amp;oauth_token_secret=xxx也是排序错误的, 两个位置对调了. scribe-java是用正则去匹配的, 所以出错了.</p>

<p>总之豆瓣折腾的最疼, 难免心里有些失望.</p>

<p><strong>总结一下</strong></p>

<p>oauth的应用越来越广泛, 互联网企业拿着互联网开发的新年开发着自己的平台, 这是一件很好的事情.</p>

<p>从开发角度来说, 不得不承认oauth并不简单, 我也并不精通oauth, 偷懒了用了别人的库或多或少出现了些问题. 我依然比较郁闷的是, scribe-java本身自己就支持一大堆国外的oauth, 并且在我看来代码都是没有什么问题的, 到了国内, 标准就不是标准了, 标准只是参考, 各家各户按照自己的理解在做. 这篇文章写完, 我也有些心虚, 一些问题可能还是我有错, 如果你发现了, 欢迎拍砖我赔礼道歉.</p>

<p>最后提一下, 在<a href="https://github.com/Arthraim/scribe-java">github上</a>把scribe-java给folk了, 添加了4大门户的微博, 欢迎其他开发者使用或贡献.</p>
]]></content>
  </entry>
  
</feed>
