
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Artoirus</title>
	<meta name="author" content="Arthur Wang">

	
	<meta name="description" content="开始做iOS应用就有一个“公理”，图片素材要使用png格式，至于公理是怎么形成的完全不知道，只是听说在官方文档里提到过一句：苹果会对png进行优化。 为什么优化？谁优化的？什么时候优化的？怎么优化的？ 和所有的魔术一样，说穿了就不好玩了。一切的根源是iPhone的显存。 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Artoirus" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Artoirus</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:artori.us">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:artori.us">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/optimized-png-in-xcode/">
		
			Xcode优化过的PNG</a>
	</h2>
	<div class="entry-content">
		<p>开始做iOS应用就有一个“公理”，<strong>图片素材要使用png格式</strong>，至于公理是怎么形成的完全不知道，只是听说在官方文档里提到过一句：苹果会对png进行优化。</p>

<p>为什么优化？谁优化的？什么时候优化的？怎么优化的？</p>

<p>和所有的魔术一样，说穿了就不好玩了。一切的根源是iPhone的显存。iPhone的vRAM在存放单个像素的颜色的时候，并不是按照传统的“红-绿-蓝”这样的顺序排列的，而是“蓝-绿-红”，即我们常说的RGB，在iPhone的显存里是BGR。并且，没有alpha通道。</p>

<p>另一边，png格式按照“红-绿-蓝”的顺序描述颜色，并且支持alpha通道的半透明，RGBA四个通道各占1个字节。</p>

<ul>
<li>为什么优化？
因为一边RGB一边BGR，一边有alpha一边没有alpha。</li>
<li>谁优化的？
文章标题已经剧透了，Xcode优化的。</li>
<li>什么时候优化的？
Xcode在编译时，会对png资源进行优化。</li>
<li>怎么优化的？
优化做了两件事：

<ol>
<li>把png里所有的RGB颜色转成BGR顺序</li>
<li>把png里所有的alpha通道先和RGB三通道先乘好（比如R:1 G:1 B:1 A:0.5的颜色直接转成 R:0.5 G:0.5 B:0.5）</li>
</ol>
</li>
</ul>


<p>这样最终设备在运行时渲染这些颜色的时候，不需要任何处理，一个汇编语句就把数据丢尽显存里了。</p>

<p>PS: <a href="http://developer.apple.com/library/ios/#qa/qa1681/_index.html">这里</a>还有一个手动转换，和还原的办法</p>

<p>via: <a href="http://iphonedevelopment.blogspot.jp/2008/10/iphone-optimized-pngs.html">http://iphonedevelopment.blogspot.jp/2008/10/iphone-optimized-pngs.html</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-12T00:07:00+08:00" pubdate data-updated="true">Dec 12<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/migrated-from-wordpress-to-octopress/">
		
			从wordpress搬到octopress</a>
	</h2>
	<div class="entry-content">
		<p>断断续续把wordpress转换到octopress上了。这是z-blog转到wordpress之后第二次更换博客系统了，octopress很酷，markdown的数据复用、搬家、存档都比lamp的wordpress轻便的多。</p>

<p>从导出wordpress数据库，转换为markdown，部署到github，搬图片文件，转换评论，磨磨蹭蹭的前前后后大约拖延了有两周，到今天终于把域名解析给换到这里来了。</p>

<p>最头疼的是转换文章的脚本不见得可靠，老文章的格式乱七八糟需要一篇一篇手动去修正，我现在做了一半，至少保证最新的大约3/5的文章是修改过的友好的格式。</p>

<p>很久没有更新博客，evernote的博客素材已经攒了一大堆，有空一篇一篇写出来吧。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-11T23:12:00+08:00" pubdate data-updated="true">Dec 11<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>Life</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/euro-2012-google-calendar-or-outlook-calendar/">
		
			2012欧洲杯Google,iCal,Outlook日历</a>
	</h2>
	<div class="entry-content">
		<p>今晚欧洲杯就开打了。在Live Calendar里导入了这个日历之后，同步到Windows Phone上很爽。</p>

<ol>
<li><p>在Google Calendar订阅好友的日历：euro2012calendar@gmail.com</p></li>
<li><p>直接访问<a href="https://www.google.com/calendar/embed?src=euro2012calendar%40gmail.com&amp;ctz=America/Denver">这个地址</a>，在最下面添加到Google Calendar</p></li>
<li><p>下载<a href="https://www.google.com/calendar/ical/euro2012calendar%40gmail.com/public/basic.ics">这个ics文件</a>导入到outlook, live calendar或iCal、iPhone等</p></li>
</ol>


<p><a href="/euro-2012-google-calendar-or-outlook-calendar/screen-shot-2012-06-08-at-3-08-39-pm/"><img src="/images/uploads/wp/Screen-Shot-2012-06-08-at-3.08.39-PM-500x298.png" alt="" /></a></p>

<p>原文地址：<a href="http://www.eurojoe.com/2012/06/01/euro-2012-google-calendar/">http://www.eurojoe.com/2012/06/01/euro-2012-google-calendar/</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-06-08T23:10:57+08:00" pubdate data-updated="true">Jun 8<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>Life</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/git-prune-branch/">
		
			Git修剪分支</a>
	</h2>
	<div class="entry-content">
		<p>项目运转的久了，很多个人的战略的bugfix的feature的分支一堆一堆，今天忍不住想清理一些已经被合并的分支。这里用到了几个相关的git命令。</p>

<ul>
<li><p><code>git branch</code> 可以查看本地有的分支，当前分支之前有个*。</p></li>
<li><p><code>git branch -r</code> 查看所有远程的分支（不代表远程还有的分支）</p></li>
<li><p><code>git branch -a --color</code> 查看所有分支（<code>--color</code>加颜色，绿色是tracking的）</p></li>
<li><p><code>git branch -d TAG</code> 删除本地分支，如果这个分支有没有合并的提交，git会提示你改用 <code>-D</code> 强制删除（或干脆别删除！）</p></li>
<li><p><code>git push REMOTE :TAG</code> 删除远程REMOTE（比如一般叫origin）分支，注意分支名前加冒号</p></li>
<li><p><code>git remote prune REMOTE</code> 这个指令比较特殊，如果你在A仓库上<code>git fetch</code>过，在B仓库用上一条命令删除了远程分支，那么A仓库里 <code>git branch -r</code> 还是可以看到已经删掉的分支。这个时候可以用这个命令修剪这些分支。</p></li>
<li><p><code>git prune</code> 在本地也可以使用，不过作用我还真不清楚，官方用推荐用 <code>git gc</code></p></li>
</ul>


<p>记录下，git真的很萌的你们不要黑他。</p>

<p>以上。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-02T08:07:32+08:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/mac-os-10-7-3-breaks-xcode-binary-validation/">
		
			Mac OS 10.7.3用xcode提交二进制文件验证失败</a>
	</h2>
	<div class="entry-content">
		<p>近日在提交一个app的时候发生了奇怪的错误。错误如下：</p>

<p><a href="/mac-os-10-7-3-breaks-xcode-binary-validation/icon-dimensions-dont-meet-the-size-requirements/"><img src="/images/uploads/wp/icon-dimensions-dont-meet-the-size-requirements.png" alt="" /></a></p>

<blockquote><p>iPhone/iPod Touch: Icon.png: icon dimensions (0 x 0) don&#8217;t meet the size requirements. The icon file must be 57x57 pixels, in .png format</p></blockquote>

<p>我使用的Xcode版本是4.2.1，其实一下子也懵了完全没头绪。我第一时间当然是以为我的Icon.png真的出问题了，因为偶尔我会自己用一个叫做prepo的app来把512的图标转成57像素的，所以我第一时间以为是它的问题。（因为它之前也把比如10k的blabla@2x.png转成了20k的blabla.png）。于是我用Photoshop重新转换了一个图标来试图解决这个错误，结果当然是失败了。</p>

<p>各种Google之后，问题被锁定到了Mac OS 10.7.3这个升级包上，升级了之后是第一次提交二进制文件。<a href="https://devforums.apple.com/message/611733">这个讨论</a>都已经说明了病灶在哪里。</p>

<p>Xcode提交当然还是存在问题，无法通过验证，而且暂时没法解决。但是办法还是有，使用更加原始的Application Loader来上传。于是我打开Application Loader并登陆之后问题又出现了。</p>

<p><a href="/mac-os-10-7-3-breaks-xcode-binary-validation/screen-shot-2012-02-10-at-12-16-13-pm/"><img src="/images/uploads/wp/Screen-Shot-2012-02-10-at-12.16.13-PM.png" alt="" /></a></p>

<p>嗯，自带的版本看来太老了。于是各种Google之后<a href="https://itunesconnect.apple.com/apploader/ApplicationLoader_2.5.1.dmg">新的版本</a>终于还是找到了。使用方法很简单，跟着向导一步一步做（前提是itunes connect上的应用已经waiting for upload状态）直到需要在硬盘选择文件。首先在Xcode里Product -> Build for -> Building for archiving。然后Xcode工程下Products目录，有个 工程名.app，右键Show in finder，在它的上一级目录里找到release版本的app。当然上传前要把它打包成zip文件，application loader不能指定.app。最后完成向导，文件终于上传成功鸟 -。- 然后可以等着review了。</p>

<p><strong>更新：</strong>好吧看到了新说法是只要装好Application Loader 2.5.1，重启xcode，clean工程，重新archive，然后就能通过验证了，不需要真的使用Application Loader上传。 没试过，不一定管用，可以试试看。</p>

<p>以上。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-02-13T04:27:59+08:00" pubdate data-updated="true">Feb 13<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/abandon-arthraim-cn/">
		
			停用arthraim.cn域名</a>
	</h2>
	<div class="entry-content">
		<p>arthraim.cn的域名又到期了，因为之前的代理被卖到别的地方了所以很烦躁这个域名不要了.cn域名也实在是操蛋的可以。</p>

<p>之前留着也只是为了做一个重定向，现在重定向了一年了搜索引擎什么的也应该反应过来了，所以就不要了吧。</p>

<p>再见arthraim.cn</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-01-06T22:52:15+08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>Life</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/arthur-s-2011-summary/">
		
			Arthur的2011年总结</a>
	</h2>
	<div class="entry-content">
		<p>还有一个小时2011年就过完了，末日年就在眼前。今年博客更新的非常少，当然我没有偷懒，公司从年底上马了新的产品之后我就全身心的投入到了新的工作里去了。</p>

<p>爱折客从去年年底开始慢慢开发到现在整一年，发展迅速，今天年终总结的时候说实话我也觉得很振奋，虽然始终我的兴趣点在social上而爱折客虽然有点像solomo，但是其实是没有social的成分的，所以我承认我并不是那么&#8221;爱&#8221;它。但是到了这个时候看着这个产品我觉得很自豪，我们是一群踏踏实实的童鞋们，没有开复老师呼风唤雨的本事，勤勤恳恳的做业绩，可能并不是很多人看到我们的成绩，但是我们很棒。</p>

<p>技术上，算是真正独立完成了一个web的客户端，初期也并没有存储全部和后面的api交互，后来做着做着后台越做越大mongodb越做越熟。另外转型iOS开发才是这一年真正拼了老命的事情，要感谢公司给我配了台iMac坦率说是动力的源泉，很有压力但是的确是动力。现在自豪的说app store上已经有5个app出自我手啦。因为要偶尔维护api，所以虽然没有系统的学不过接触了ruby on rails，很有魅力！</p>

<p>依然看了很多电影，没有去年多当然。依然看了很少书。动画几乎没看，剧集也是有一集没一集的追。在游戏上花的钱更多了，因为今年掌机换代了，入手了PSVita，也算是5年一次的大开销吧。</p>

<p>希望明年公司蒸蒸日上，希望自己大大进步。2012我来了。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-01-01T07:07:29+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>Life</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/windows-phone-wbt/">
		
			Windows Phone版微博通</a>
	</h2>
	<div class="entry-content">
		<p>很久没有写博客了，已经有友联的童鞋抱怨了，最近这段时间很忙，几乎下班就没心情做自己的事情了。话说最近入手了一台WP7，三星focus，白菜价，手机丢了所以来不及等Nokia Lumia 800了，很急就入手了。话说这不是重点，我手痒然后卸掉了WP7sdk的beta2，装上了新的7.1，小玩了一下。</p>

<p>话说其实给WP7写应用还真的蛮好玩的，事实上marketplace实际上也比我想象的要热闹一点，所以还蛮有动力写点东西的，最近在公司写iOS的app，每天都是objective-c，捡起了以前的C#真是一下子觉得好厉害，一个天一个地啊，终于不用自己retain, release了。</p>

<p>对了写了两段还是没有说到重点，因为重点就一句话，在熟悉WP7的开发，所以写了个微博通的客户端，好吧只是调用api发个post的请求而已很简单，主要是自己熟悉一下。</p>

<p>对了东西已经开源了在<a href="https://github.com/Arthraim/WbtoMongo">这里</a></p>

<p>那写到这里就写完了。感叹一下，visual studio真的不错，现在.net的包管理也很方便！现在dotnet我已经算是局外人了，所以不嘴贫了 -。-</p>

<p>以上</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-12-12T00:53:41+08:00" pubdate data-updated="true">Dec 12<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/ruby-is-horribl/">
		
			Ruby好可怕</a>
	</h2>
	<div class="entry-content">
		<p>接触ruby时间不长，用的机会就更少了，所以偶尔用一下的时候难免还要去翻翻文档什么的。维护某个后台的时候，有个随机输出的需求，所以我写了下面这样一段代码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="n">ver</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span> <span class="o">==</span> <span class="kp">nil</span> <span class="p">?</span> <span class="s1">&#39;i&#39;</span> <span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@preview_items</span> <span class="o">=</span> <span class="no">MyItem</span><span class="o">.</span><span class="n">where</span><span class="p">({</span><span class="ss">:version</span> <span class="o">=&gt;</span> <span class="n">ver</span><span class="p">,</span> <span class="ss">:order</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="o">[</span><span class="ss">:order</span><span class="p">,</span> <span class="ss">:desc</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>  <span class="vi">@preview_items</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</span><span class='line'>    <span class="n">order</span> <span class="o">=</span> <span class="n">item</span><span class="o">[</span><span class="s1">&#39;order&#39;</span><span class="o">]</span>
</span><span class='line'>    <span class="n">map</span><span class="o">[</span><span class="n">order</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span> <span class="k">if</span> <span class="n">map</span><span class="o">[</span><span class="n">order</span><span class="o">]</span> <span class="o">==</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="n">map</span><span class="o">[</span><span class="n">order</span><span class="o">].</span><span class="n">push</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@json_items</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">map</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span>
</span><span class='line'>    <span class="n">arr</span> <span class="o">=</span> <span class="n">map</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>      <span class="vi">@json_items</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="vi">@json_items</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">arr</span><span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">render</span> <span class="n">json</span><span class="p">:</span> <span class="vi">@json_items</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:callback</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>rails某个模型的index页面，具体做了什么呢？大概是四件事情：</p>

<ol>
<li><p>取参数version</p></li>
<li><p>在数据库查询该version并且order字段大于0的数据，根据order字段倒叙排列（数据库是mongodb，driver用mongoid）</p></li>
<li><p>遍历查询的结果建立一张以order为key，相应order的实体数组为value的表</p></li>
<li><p>遍历3中的表，每个order的数组中随机抽取一个元素作为这个order的唯一值</p></li>
</ol>


<p>最后把获取的新数据render。</p>

<p>看起来很满足什么的，就提交代码了。之后同事部署前，看了看这里的更新，然后最终把代码完全改掉了。只用了一行 =。=</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="vi">@json_items</span> <span class="o">=</span> <span class="no">MyItem</span><span class="o">.</span><span class="n">where</span><span class="p">({</span><span class="ss">:version</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:version</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="ss">:order</span><span class="o">.</span><span class="n">gt</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">})</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="o">[</span><span class="ss">:order</span><span class="p">,</span> <span class="ss">:desc</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:order</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span><span class="o">.</span><span class="n">sample</span><span class="p">}</span>
</span><span class='line'>  <span class="n">render</span> <span class="n">json</span><span class="p">:</span> <span class="vi">@json_items</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:callback</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>做的事情是完全一样的。</p>

<ol>
<li><p>他先看了取参数，不用三元，直接 || 一个默认值</p></li>
<li><p>然后他把第4步中的取随机的部分改了，因为数组中随机取一个元素，ruby直接有sample方法</p></li>
<li><p>然后他又觉得第四步可以更简单的调用hash的map方法，映射成另一个value = value.sample的map</p></li>
<li><p>最后他吃了顿中饭回来灵光一闪，终于发现第三步做的就是一个group_by的事情，ruby可以做这个事情</p></li>
</ol>


<p>于是，除了查询不变，所有的逻辑全部调用了ruby现成的方法完成了！哥落伍了…… 越发觉得ruby好强大。</p>

<p>BTW，帮我改代码的是@niedhui</p>

<p>以上……</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-09-11T20:40:56+08:00" pubdate data-updated="true">Sep 11<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/nomethoderror-undefined-method-specifications/">
		
			NoMethodError: Undefined Method `specifications&#8217; &#8230;</a>
	</h2>
	<div class="entry-content">
		<p>今天在和同事说，我最喜欢写这样的文章了，很多人会碰到的异常，而且没有什么中文资料，可以给搜索引擎个好排名（喂你心机好重。好吧其实我的想法很伟大的哦，我是给以后会遇到一样问题的你造福哦~</p>

<p>重新搭新环境，先装了rvm，然后装上gem，用gem装了rails。之后呢问题就出来，尝试用bundle exec rake db:seeds的时候会出错，加上&#8211;track参数一看大概是这样子。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>undefined method `specifications' for "/Users/arthraim/.rvm/gems/ruby-1.9.2-p290":String</span></code></pre></td></tr></table></div></figure>


<p>好像后面也不是特别重要了，只是这个问题比较费解，之前同事好像也遇到过。去Google了一下，居然是gem版本太高的关系，要把gem降级到早一些的版本。不想深究下去了，就说一下解决的办法好了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem update --system 1.7.2</span></code></pre></td></tr></table></div></figure>


<p>之前我的版本是1.8.5，虽然不知道具体什么情况，不过1.7.2就可以了。话说gem update到老版本的方法好神奇 -。-</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-07-21T05:11:17+08:00" pubdate data-updated="true">Jul 21<span>st</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2012

    Arthur Wang

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'artorius';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-8352384-7']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>