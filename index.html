
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Artoirus</title>
	<meta name="author" content="Arthur Wang">

	
	<meta name="description" content="总是想到这个忘了那个，记录一笔 bundle_id 和实际的 appid 一致
选择的Provisioning profile对不对（有时候auto会使用通配的profile）
portal中对应的appid是否开启推送，是否有推送证书
provisioning &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Artoirus" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Artoirus</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:artori.us">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:artori.us">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/no-valid-aps-environment-entitlement-string-found-for-application/">
		
			未找到应用程序的“aps-environment”的权利字符串</a>
	</h2>
	<div class="entry-content">
		<p>总是想到这个忘了那个，记录一笔</p>

<ol>
<li>bundle_id 和实际的 appid 一致</li>
<li>选择的Provisioning profile对不对（有时候auto会使用通配的profile）</li>
<li>portal中对应的appid是否开启推送，是否有推送证书</li>
<li>provisioning profile是否是在appid开启推送后再生成的</li>
<li>设备是否是adhoc的profile包括的设备</li>
</ol>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-31T08:54:00+08:00" pubdate data-updated="true">Jul 31<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/wwdc-2013-session-203-whats-new-in-cocoa-touch/">
		
			WWDC 2013: Session 203 What’s New in Cocoa Touch</a>
	</h2>
	<div class="entry-content">
		<p>继续简单贴WWDC的笔记。这个session内容相当多啊。</p>

<p>session 203 关于Cocoa Touch的改动，先看这个也是个人兴趣所致。随着iOS7的大动作，Cocoa Touch的改动真心多，还有更多更多细节可能没发现。</p>

<h3>多任务</h3>

<p>iOS7中多任务是一个重头戏。这里讲到三种。这些改动都是让我非常激动的。</p>

<h4>background fetching | 后台抓取</h4>

<p>这个应该是为了满足类似ping、心跳这样的需求，定时往服务器去抓数据。xcode5的Capabilities设置里，打开Background Modes，可以直接勾选到一个background mode：「Background fetch」。</p>

<p>主要涉及的API如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">performFetchWithCompletionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">UIBackgroundFetchResult</span> <span class="n">result</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setMinimumBackgroundFetchInterval:</span><span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">minInterval</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>remote notifications | 远程通知</h4>

<p>这是个很酷的功能。让app能够在接到一条推送消息的时候后台打开一个下载任务。</p>

<p>例如微信收到新消息推送后打开app，还会有一个连接下载的过程。现在接到推送的同时，就可以在后台把新消息抓过来，打开应用后app已经呈现了这个消息。另外可以想到的更酷的应用，是例如追美剧的那些视频软件，美剧一更新就通过推送把新的一集抓下来，用户下次进入app的时候就可以直接离线看了。</p>

<p>同样Capabilities设置里有一个选项「Remote notifications」</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didReceiveRemoteNotification:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">userInfo</span> <span class="nf">fetchCompletionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">UIBackgroundFetchResult</span> <span class="n">result</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>background transfers | 后台传输</h4>

<p>这是个比较基本的功能，发起一个网络请求可以在app切到后台或关闭后继续完成（当然你也可以中端或暂停它）</p>

<p>这里有个变化是Cocoa提供了一个新的类NSURLSession来取代NSURLConnection，这个新类可以快速发起background的请求。请求完成后app可以处理一个回调，展示下载完成的图片或其他资源。更多关于NSURLSession的内容在WWDC session 705「What&#8217;s new in Foundation Networking」中有更具体的说明。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">handleEventsForBackgroundURLSession:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">identifier</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">UIBackgroundFetchResult</span> <span class="n">result</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Views and Images</h3>

<h4>UIImage的renderingMode</h4>

<p><code>- (UIImage *)imageWithRenderingMode:(UIImageRenderingMode)renderingMode;</code> 可以得到一个设置了renderingMode的图片，默认他是auto的，另外它还会有original和template两种绘制模式，后者无视图片中的颜色信息。</p>

<h4>Tint</h4>

<p>现在好像可以很懒惰的处理整个app的风格了，只要设置好tint，各种文字、图标的颜色都会自动切换过去。具体涉及到<code>UIView</code>的<code>tintColor</code>属性以及<code>tintAdjustmentMode</code>属性。而新的代理<code>- (void)tintColorDidChange;</code>可以让你知道tint改变的情况。</p>

<h4>UIView Animation</h4>

<p>iOS7的动画加强了不少。涉及动画的改动也不少。</p>

<p><code>+ (void)performWithoutAnimation:(void (^)(void))actionsWithoutAnimation;</code> 可以强制一些动作不使用动画。不知道之前让我郁闷的要死的<code>UITableViewRowAnimationNone</code>还是有动画的问题能不能解决。</p>

<p>CocoaTouch提供了关键帧动画的API。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">animateKeyframesWithDuration:</span><span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">duration</span> <span class="nf">delay:</span><span class="p">(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">delay</span> <span class="nf">options:</span><span class="p">(</span><span class="n">UIViewKeyframeAnimationOptions</span><span class="p">)</span><span class="nv">options</span> <span class="nf">animations:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="nv">animations</span> <span class="nf">completion:</span><span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">BOOL</span> <span class="n">finished</span><span class="p">))</span><span class="nv">completion</span><span class="p">;</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addKeyframeValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">time:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">time</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>另外还有Motion Effects，动画可以结合重力感应什么的大概是这样。</p>

<h3>Collection View</h3>

<p>这个是去年的新东西，强大到什么瀑布流、coverflow都能用layout实现。今年提供了一个在layout之间快速切换的方法。数据不变，layout换一下界面从瀑布变coverflow不是梦想。具体细节不纠结了。</p>

<h3>View Controllers</h3>

<p>其实我觉得最担心的就是这个东西。因为可以看到statusbar navigationbar tabbar都是半透明毛玻璃了，我怎么让一个tableview显示在整屏却只在中间区域让用户滚动呢（能滚到中间，不会有cell躲在tabbar下面，但要让tabbar半透明看到滚下去的cell）？</p>

<p>viewcontorller涉及到下面的一些改动。</p>

<h4>wantsFullScreenLayout</h4>

<p>现在的viewcontroller始终保持iOS6设置<code>wantsFullScreenLayout</code>为YES的状态。StatusBar、NavigationBar等等都会变成半透明。真是丧心病狂！然后<code>wantsFullScreenLayout</code>这个属性就没了。因为它被始终设为YES。</p>

<h4>extended edges</h4>

<p>这个extended edges的属性，帮我解决了之前的担心。现在怎么让一个scrollView内容显示在中间部分，却可以滚到那些Bar下面实现半透明，就靠这个属性。让viewcontroller的extended edges变成你要躲开的控件的高度宽度就可以。描述不清楚，你们体会下。orz</p>

<h4>content size</h4>

<p>用<code>preferredContentSize</code>属性来设置你期望的大小，iOS7现在会用它来决定自己的大小。一般应该只有子界面才用得到。</p>

<h4>status bar</h4>

<p>因为全屏，所以现在的statusbar是没有背景颜色的。 <code>UIStatusBarStyleBlackTranslucent</code>和<code>UIStatusBarStyleBlackOpaque</code>两个枚举都被deprecated了。新的<code>UIStatusBarStyleLightContent</code>可以让你设置，万恶的毛玻璃。<code>UIStatusBarStyleDefault</code>不变。</p>

<h4>custom transition</h4>

<p>可以定制transition。比如navigation的push pop，viewController的present dismiss，或者手势控制的各种。另外新的代理<code>UIViewControllerTransitioningDelegate</code>（viewcontroller有相应属性）和新的protocol<code>UIViewControllerAnimatedTransitioning</code>、<code>UIViewControllerInteractiveTransitioning</code>、<code>UIViewControllerContextTransitioning</code>，具体的方法文档有，不知道用到的机会有多少。</p>

<h3>状态恢复</h3>

<p>现在新的App状态恢复，系统会给你截一张图，让你的程序的恢复变得无缝。</p>

<p>但事实上，很有可能截图和应用恢复后实际的数据或界面不一样，于是你可以用新的方法<code>- (void)ignoreSnapshotOnNextApplicationLaunch;</code>屏蔽之前的截图。</p>

<p>另外你可以用<code>+ (void) registerObjectForStateRestoration:(id&lt;UIStateRestoring&gt;)object restorationIdentifier:(NSString *)restorationIdentifier;</code>把<strong>和界面无关</strong>的数据对象保存下来。</p>

<p>蓝牙状态也可以恢复，这一块不太熟悉，总之系统帮你保存了一些状态，有两个新的key让你取到他们。</p>

<h3>AirDrop</h3>

<p>这个session里笼统的说了一下，你可以注册protocol，每个app沙箱多了一个inbox目录等等，不深入了（视频里也没深入说啊）。</p>

<h3>Dynamics</h3>

<p>「Getting started with UIKit Dynamics」和「Advanced Techniques with UIKit Dynamics」两个session详细介绍了这一块。</p>

<p>具体这货就是让你做一些效果，两个view粘在一起，view带上物理特效，碰撞、重力感应什么的高级货。</p>

<ul>
<li><code>UIDynamicAnimator</code> 操作一些动画的模型</li>
<li><code>UIDynamicBehavior</code> 记录各种动作的一棵树</li>
<li><code>UIDynamicItem</code> 这个protocol让控件变成你要操作的对象</li>
</ul>


<h3>Text</h3>

<p>iOS7的设置里，用户可以用一个滑槽修改字体大小了。</p>

<p>开发者可以用<code>UIApplication</code>的<code>preferredContentSizeCategory</code>属性取到用户设置的字体大小。</p>

<p>取到的值是一个<code>UIContentSizeCategorySize...</code>枚举，有XS、S、M、L、XL、XXL、XXXL几个档次。</p>

<p>用户修改这个设置的时候，会发送一个notification: <code>UIContentSizeCategoryDidChangeNotification</code>，使用新的key<code>UIContentSizeCategoryNewValueKey</code>可以从notification中取到修改后的字体大小。</p>

<p>另外<code>+ (UIFont *)preferedFontForTextStyle:(NSString *)style;</code>方法可以用「标题文字」「正文文字」这样的形式来获得一些固定的UIFont。</p>

<h3>Text Kit</h3>

<p>这是一个全新的Kit，基于CoreText。具体「Introducing Text Kit」和「Advanced Text Layouts and Effects with Text Kit」以及「Using fonts with Text Kit」三个session涉及到这一块。</p>

<p>这货大致有三个类</p>

<ul>
<li><code>NSTextContainer</code> 是最外面文字布局的容器</li>
<li><code>NSLayoutManager</code> 是内部的布局</li>
<li><code>NSTextStorage</code> 文字的数据</li>
</ul>


<p>修改文字布局只要按需要派生其中一层就可以，还有个<code>NSTextAttachment</code>可以图文混排什么的。细节跳过。</p>

<h3>More</h3>

<p>Session最后提到了其他一下CocoaTouch的修改，罗列一下。</p>

<ul>
<li>Local networking</li>
<li>Sprite Kit</li>
<li>game controllers</li>
<li>MapKit</li>
<li>CoreLocation</li>
<li>game center

<ul>
<li>new turn based api (like letter press)</li>
</ul>
</li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-19T10:43:00+08:00" pubdate data-updated="true">Jun 19<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/wwdc-2013-session-404-advances-in-objective-c/">
		
			WWDC 2013: Session 404 Advances in Objective-c</a>
	</h2>
	<div class="entry-content">
		<p>看了几个WWDC的session，做了一些笔记，简单贴在博客上吧。</p>

<p>404这个session大概说了objective-c的一些变化，和去年比起来改动实在是不多。</p>

<h3>module</h3>

<p>这个改动比较引人瞩目，简单说就是写#import的时候改成@import。#include是复制粘帖，#import是#define保护下复制粘帖，@import则用了一个结构去维护。</p>

<p>在工程设置里，把「Enable Modules (C and Objective-C)」设为YES，不用改代码就能自动生效。会提高编译和索引的速度。</p>

<p>有一句话很刺眼叫「not available for user frameworks」，呵呵。</p>

<p>另外随之而来的Auto Linking特性，你不用自己去加那些依赖了。</p>

<h3>refactor tools</h3>

<p>重构工具什么的，然后又提了提literals的语法什么的。说起后者今天看到<a href="http://nshipster.com/object-subscripting/">一篇文章</a>，把object subscripting（这货就是比如说array[@3], dictionary[@&#8221;key&#8221;]这样）扩展成一门DSL。</p>

<h3>instancetype</h3>

<p>这个改动我觉得挺重要。以前方法（尤其init）返回一个指针的时候用<code>id</code>作为类型。编译器其实很难（几乎不能）对它的类型作出判断。新增这个instancetype来声明返回值类型，可以避免很多不安全的问题。</p>

<p>比如Foo的init方法返回一个NSArray，调用的时候写成<code>NSDictionary *dict = [[Foo alloc] init];</code>。如果init方法是<code>-(id)init</code>，那编译器啥也不知道。如果改写成<code>-(instancetype)init</code>，xcode会警告你这里类型有问题了。</p>

<h3>explicitly-typed enums</h3>

<p><code>cell.selectionStyle = UITableViewCellAccessoryCheckmark</code>这种不同枚举类型的赋值会得到一个警告了。另外xcode的自动完成也更智能了。别忘了用<code>NS_ENUM</code>这个宏来写枚举哟。</p>

<h3>runtime</h3>

<p>有一些改动，比如新的tagged pointer，以及使用isa的警告等等。下一节还提到了一些retain环的警告等等等等。</p>

<h3>GC -> ARC</h3>

<p>苹果不要GC了，都用ARC了，包括Xcode 5在内的一些工程都放弃GC了。</p>

<p>另外ARC还有些进化。<code>__weak</code>更快了，说是x2快。dubug的<code>autorelease</code>处理更接近release build了。</p>

<h3>CF bridge</h3>

<p>CoreFoundation框架的桥也全都优化了，提到implicit bridging的时候全场掌声，本人level太低不理解什么意思。</p>

<p>笔记大概就是这些，感觉很多都没怎么听懂，还需要补课。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-18T10:27:00+08:00" pubdate data-updated="true">Jun 18<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/easy-deploy-with-uwsgi/">
		
			快速使用uwsgi部署</a>
	</h2>
	<div class="entry-content">
		<p>之前尝试在阿里云部署一个bottle.py写的web服务，选择了unbuntu12.04，一穷二白的ubuntu上用uwsgi部署还挺简单的。这里简单记录一下。</p>

<p>先要改一改程序代码，声明一个application</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="n">application</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">app</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后安装uwsgi，demo.py就是修改过的bottle的代码。</p>

<p>这里我遇到了<code>— unavailable modifier requested: 0 --</code>，要安装uwsgi-plugin-python，并且uwsgi启动时候添加<code>--plugin python</code></p>

<p>一些uwsgi的操作看<a href="http://uwsgi-docs.readthedocs.org/en/latest/Management.html">这里</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>apt-get install uwsgi uwsgi-plugin-python
</span><span class='line'>uwsgi --socket :8000 --plugin python --file demo.py --processes 4 --pidfile /tmp/demo.pid --touch-reload<span class="o">=</span>/tmp/restart -d uwsgi.log
</span></code></pre></td></tr></table></div></figure>


<p>安装nginx</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>apt-get install libpcre3 libpcre3-dbg libpcre3-dev
</span><span class='line'>apt-get install zlib1g zlib1g-dbg zlib1g-dev
</span><span class='line'>apt-get install make
</span><span class='line'><span class="nb">cd</span> /path/to/nginx
</span><span class='line'>./configure
</span><span class='line'>make
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>最后配置nginx。默认安装路径在<code>/usr/local/nginx/conf/nginx.conf</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">server</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">listen</span>       <span class="mi">80</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">server_name</span>  <span class="nx">demo</span><span class="p">.</span><span class="nx">artori</span><span class="p">.</span><span class="nx">us</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">location</span> <span class="o">/</span><span class="kr">static</span><span class="o">/</span> <span class="p">{</span> <span class="nx">alias</span> <span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">root</span><span class="o">/</span><span class="nx">demo</span><span class="o">/</span><span class="kr">static</span><span class="o">/</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">uwsgi_pass</span>      <span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">:</span><span class="mi">8000</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">include</span>         <span class="nx">uwsgi_params</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>自此搞定</p>

<p>via:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/10748108/nginx-uwsgi-unavailable-modifier-requested-0">http://stackoverflow.com/questions/10748108/nginx-uwsgi-unavailable-modifier-requested-0</a></li>
<li><a href="http://lists.unbit.it/pipermail/uwsgi/2011-November/002923.html">http://lists.unbit.it/pipermail/uwsgi/2011-November/002923.html</a></li>
<li><a href="http://aaronsnow.tumblr.com/post/11560674160/nginx-uwsgi-bottle-py">http://aaronsnow.tumblr.com/post/11560674160/nginx-uwsgi-bottle-py</a></li>
<li><a href="https://groups.google.com/forum/?fromgroups=#!topic/bottlepy/wRfgm4obLXk">https://groups.google.com/forum/?fromgroups=#!topic/bottlepy/wRfgm4obLXk</a></li>
<li><a href="http://blog.felixc.at/2011/01/ubuntu-uwsgi-nginx-bottle-configuration/">http://blog.felixc.at/2011/01/ubuntu-uwsgi-nginx-bottle-configuration/</a></li>
<li><a href="http://apt-blog.net/moinmoin-on-nginx-via-fastcgi-and-uwgi">http://apt-blog.net/moinmoin-on-nginx-via-fastcgi-and-uwgi</a></li>
<li><a href="http://down.chinaz.com/server/201112/1467_1.htm">http://down.chinaz.com/server/201112/1467_1.htm</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-04-14T01:02:00+08:00" pubdate data-updated="true">Apr 14<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/uiwebview-load-local-javascript/">
		
			UIWebView加载本地资源</a>
	</h2>
	<div class="entry-content">
		<p>作为一个不会javascript只会jQuery的程序员，我在做<a href="https://github.com/Arthraim/objs">Objective-c和HTML5页面交互的demo</a>的时候需要HTML至少依赖一个jQuery，放在本地咋整？</p>

<h2>创建UIWebView的时候</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">_webView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIWebView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)];</span>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">htmlFile</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource:</span><span class="s">@&quot;index&quot;</span> <span class="nl">ofType:</span><span class="s">@&quot;html&quot;</span><span class="p">];</span>
</span><span class='line'><span class="n">NSString</span><span class="o">*</span> <span class="n">htmlString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithContentsOfFile:</span><span class="n">htmlFile</span> <span class="nl">encoding:</span><span class="n">NSUTF8StringEncoding</span> <span class="nl">error:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="n">NSString</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="n">bundlePath</span><span class="p">];</span>
</span><span class='line'><span class="n">NSURL</span> <span class="o">*</span><span class="n">baseURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">fileURLWithPath:</span><span class="n">path</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">_webView</span> <span class="nl">loadHTMLString:</span><span class="n">htmlString</span> <span class="nl">baseURL:</span><span class="n">baseURL</span><span class="p">];</span>
</span><span class='line'><span class="c1">// 把baseURL知道bundle的Url，就能调用bundle里的其他文件了，图片音乐什么的</span>
</span><span class='line'><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">_webView</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">_webView</span> <span class="n">release</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>添加.js文件的时候</h2>

<p>添加js文件有点特殊，xcode会以为js是可以编译的代码。要在Xcode的target里，把.js文件从 &#8220;Compile Sources&#8221; 移到 &#8220;Copy Bundle Resources&#8221; .</p>

<h2>写HTML的时候</h2>

<p>可以直接写相对路径了。<code>&lt;script src="jquery.min.js"&gt;&lt;/script&gt;</code></p>

<p><strong>题外话1</strong>: 有个基友要做一个HTML5播放视频的东东，想把视频缓存到本地，但是UIWebView无视HTML5 mainifest里指定的音频视频文件，还有5M的限制。其实也可以存下来本地加载撒。</p>

<p><strong>题外话2</strong>: objc可以用stringByEvaluatingJavaScriptFromString:在webview里执行脚本。js要调用objective-c就比较麻烦。iOS可行的办法是利用custom URL scheme，跳转到应用之后应用或从path或从querystring来判断js要调用什么类什么方法，比较蛋疼。最理想的方式应该是<a href="https://developer.apple.com/library/mac/#documentation/AppleApplications/Conceptual/SafariJSProgTopics/Tasks/ObjCFromJavaScript.html">safari插件支持的方式</a>，可惜iOS没有。</p>

<p>via:</p>

<ul>
<li><a href="https://devforums.apple.com/message/32282">https://devforums.apple.com/message/32282</a></li>
<li><a href="http://mentormate.com/blog/iphone-uiwebview-class-local-css-javascript-resources/">http://mentormate.com/blog/iphone-uiwebview-class-local-css-javascript-resources/</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-27T18:19:00+08:00" pubdate data-updated="true">Mar 27<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/arthur-s-2012-summary/">
		
			Arthur的2012总结</a>
	</h2>
	<div class="entry-content">
		<p>我觉得这篇2012年总结如果今天不写估计我这辈子都不会写了。2012的末日没有如期而至，以至于写2012年末总结的计划不得不又被提上日程了。</p>

<p>2012年总的来说发生的事情不算多，但是心态变了很多。</p>

<p>博客几乎没怎么折腾，偶尔写了几篇文章。换了octopress。换完博客系统的时候倒是热情高涨把evernote里攒下的素材写了一堆。不过现在又瞬间消极怠工了。</p>

<h3>dev</h3>

<p>今年主要是iOS开发结结实实的盖了几层楼，从之前搭搭积木的阶段，终于到了可以自己造轮子的程度了。完成了几个公司里的产品、项目。现在正在给自己做一个简单的app，买了idp，打算最后把这个应用弄到appstore上，虽然很多人不看好，不过我的初衷也只是做着玩，才没有改变世界的伟大志向呢。</p>

<p>另外因为参与了一个微博应用开发，所以对python、bottle.py、uwsgi都熟悉了不少，之前提到的那个app，以及接下来要说的小玩具的服务端，也都是用bottle和mongodb架起来的，不过VPS能力有限部署的时候还是用了passenger wsgi。</p>

<p>说的小玩具是一个arduino做的小东西，其实就是按一下按钮发一条微博，把它当作门铃来用的话就可以知道家里有没有人按门铃了，虽然知道了也没办法进一步才去什么错失。。。 关于这个东西欢迎关注微博@<a href="http://weibo.com/micbell">阳哥的门铃</a></p>

<h3>life</h3>

<p>依然在魔都打拼，因为之前公司搬到杨浦，所以也住到杨浦来了，和好基友@lionelzhang 好基友@luosky 同居了，住在复旦大学附近，欢迎来做客，做客前记得联系，我好搞下卫生。</p>

<p>10月份的时候正式跳槽了，离开之前的人间网、爱折客，从创业公司来到了一家金融企业。新的工作新的环境，包括换工作这件事情本身，在我内心起了不少化学变化。说实话这个决定让我失去了不少珍惜的甚至引以为傲的东西，当然也感受到了很多期待之内期待之外的新东西。</p>

<p>要说今年印象深刻的好玩经历。十一的时候租了一辆车一路疾行500公里路去参加一个同事的婚礼，吃过晚饭出发，到了那里的时候已经是后半夜了。作为一个今年换了10年期驾照的「老司机」来说，第一次开这样的远门是不是太水了一点。在台州的时候还出了第一次车祸哦。。。</p>

<p>另一个大事就是欧洲杯，不被看好的意大利居然一路杀进决赛。决赛是转成跑到宁波去看的，不过输的也太难看了一点吧。</p>

<h3>diagram</h3>

<p>好吧最后是去过的地方、看过的书、看过的电影。</p>

<p><a href="/images/uploads/octo/2012_places.png"><img src="/images/uploads/octo/2012_places.png" alt="" /></a></p>

<p><a href="/images/uploads/octo/2012_books.png"><img src="/images/uploads/octo/2012_books.png" alt="" /></a></p>

<p><a href="/images/uploads/octo/2012_movies.png"><img src="/images/uploads/octo/2012_movies.png" alt="" /></a></p>

<p>2013加油。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-03-15T13:27:00+08:00" pubdate data-updated="true">Mar 15<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>Life</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/bottle-autojson-with-pymongo/">
		
			Bottle直接返回pymongo查询结果</a>
	</h2>
	<div class="entry-content">
		<p>以前提到过<a href="/bottle-i-love-this-framework/">bottle</a>，也写过在<a href="/use-mongodb-with-django/">django里使用pymongo</a>，这次是在bottle里用pymongo。</p>

<p>bottle有类似ROR的一些特性，比如处理请求的时候直接return一个字典，框架会自动把它parse成json（autojson）。</p>

<p>我是想偷个懒来着，把代码写成了下面这样。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="nd">@get</span><span class="p">(</span><span class="s">&#39;/api/today&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">api_today</span><span class="p">():</span>
</span><span class='line'>    <span class="n">udid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;udid&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coll</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">&#39;udid&#39;</span><span class="p">:</span><span class="n">udid</span><span class="p">,</span> <span class="s">&#39;date&#39;</span><span class="p">:</span><span class="n">today</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>这会有问题，因为find_one返回的bson没办法直接parse。伟大的发明都是在偷懒的时候诞生的，看起来我要做的事情也很简单，只要能让我改一改parser就行了。</p>

<ol>
<li>写一个dump方法替换原来JSONPlugin里的</li>
<li>设置Bottle app的autojson为False。<code>Bottle(autojson=False)</code></li>
<li>把有自己dump方法的JSONPlugin给install到app里</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='py'><span class='line'><span class="k">class</span> <span class="nc">MongoEncoder</span><span class="p">(</span><span class="n">JSONEncoder</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">mongo_dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
</span><span class='line'>        <span class="c"># convert all iterables to lists</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># convert cursors to lists</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">Cursor</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># convert ObjectId to string</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bson</span><span class="o">.</span><span class="n">objectid</span><span class="o">.</span><span class="n">ObjectId</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="c"># dereference DBRef</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">bson</span><span class="o">.</span><span class="n">dbref</span><span class="o">.</span><span class="n">DBRef</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">db</span><span class="o">.</span><span class="n">dereference</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="c"># db is the incetance database</span>
</span><span class='line'>        <span class="c"># convert dates to strings</span>
</span><span class='line'>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
</span><span class='line'>            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">app</span> <span class="o">=</span> <span class="n">app</span><span class="p">()</span>
</span><span class='line'><span class="n">app</span><span class="o">.</span><span class="n">autojson</span> <span class="o">=</span> <span class="bp">False</span>
</span><span class='line'><span class="n">m_encoder</span> <span class="o">=</span> <span class="n">MongoEncoder</span><span class="p">()</span>
</span><span class='line'><span class="n">app</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">JSONPlugin</span><span class="p">(</span><span class="n">json_dumps</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">dumps</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">m_encoder</span><span class="o">.</span><span class="n">mongo_dumps</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>via:</p>

<ul>
<li><a href="https://github.com/defnull/bottle/issues/287">https://github.com/defnull/bottle/issues/287</a></li>
<li><a href="https://gist.github.com/2779820">https://gist.github.com/2779820</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-19T10:32:00+08:00" pubdate data-updated="true">Dec 19<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/exclusive-or/">
		
			异或</a>
	</h2>
	<div class="entry-content">
		<p>不介绍什么是异或了，有人叫半加、数学系的叫按位模2加</p>

<p>下文用得到的一些简单的性质</p>

<ul>
<li><p><code>x^0 = x</code> 且 <code>x^x = 0</code></p></li>
<li><p>交换律：<code>x^y = y^x</code></p></li>
<li><p>结合律：<code>(x^y)^z = x^(y^z)</code></p></li>
<li><p>自反性：<code>x^y^y = x</code></p></li>
</ul>


<p>下面是几个小题目，可以用异或解决，挺有技巧性</p>

<h2>交换两个数ab</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">^</span><span class="n">b</span>
</span></code></pre></td></tr></table></div></figure>


<p>有意思的是搜索其他异或例子的时候，发现了<a href="http://blog.chinaunix.net/uid-1844931-id-3034714.html">这篇</a>文章，文章里实现了一个异或交换的算法，和本文主题无关，不过很有意思，函数更多的时候应该只操作值而不是变量。</p>

<p><strong>UPDATE_2013-05-06</strong>: 这个，看到云风写了一个利用这个特性做的<a href="http://blog.codingnow.com/2013/05/xor_linked_list.html">双向链表</a>，挺好玩，忍不住写过来。</p>

<h2>A集合里拿掉数x得到B集合，求x</h2>

<p>令<code>XOR(X)</code>表示将X集合内所有的数做异或</p>

<p><code>XOR(B)^XOR(A) = XOR(B)^XOR(B)^x = 0^x = x</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'><span class="n">B</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="o">[</span><span class="mi">1234</span><span class="o">]</span>
</span><span class='line'><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:^</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">x</span> <span class="c1">#1234</span>
</span></code></pre></td></tr></table></div></figure>


<p>via: <a href="http://www.javaeye.com/topic/420487">http://www.javaeye.com/topic/420487</a></p>

<h2>A集合里拿掉数x、y得到B集合，求x和y</h2>

<p>首先按上一个的办法可以推导出<code>xor(A)^xor(B) = xor(B)^xor(B)^x^y = 0^x^y = x^y</code></p>

<p><code>x^y</code>的二进制结果，第n位为1，说明x和y的第n位不相同</p>

<p>根据第n位是否为0把A里所有的数分成A1和A0两个数组（A1里的数的二进制第n位都是1，A0都是0）</p>

<p>A1和A0应该各包含了a或者b（这样第n位才能异或出1）</p>

<p>同理可以把B分成B1和B0两个数组</p>

<p>可以得到第一个数 <code>x = A1^B1</code></p>

<p>第二个数可以<code>y = A0^B0</code>，当然也可以用<code>x^y^x</code>求得</p>

<p>另外如果<code>x^y</code>为0，即<code>x == y</code>，令<code>SUM(X)</code>为X集合内所有数求和</p>

<p><code>(SUM(A) - SUM(B)) / 2 = x</code></p>

<p>via: <a href="http://blog.chinaunix.net/uid-12453618-id-2935334.html">http://blog.chinaunix.net/uid-12453618-id-2935334.html</a></p>

<h2>集合A里只有数x出现1次，其余数全都重复出现2次，求x</h2>

<p><code>xor(A) = x^y^y^…^z^z = x^(y^y^…^z^z) = x^0 = x</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:^</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>集合A里只有数x出现1次，其余数全都重复出现3次，求x</h2>

<p>xor的本质相当于“按位模2加”（adding modulo 2），令p1,p2…pn为布尔值，true为1、false为0，(+)表示异或操作。</p>

<p><code>p1 (+) p2 (+) ... (+) pn == ( p1 + p2 + ... + pn ) % 2</code></p>

<p>所以只需要实现按位模3加</p>

<p><code>( p1 + p2 + ... + pn ) % 3</code></p>

<p>将集合中所有数二进制表示的同一位的0或1相加，最终的和对3去摸，得到的数即是x</p>

<p>如 <code>A = {5, 7, 7, 7}</code>，二进制表示两个数</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="mi">101</span>
</span><span class='line'>  <span class="mi">111</span>
</span><span class='line'>  <span class="mi">111</span>
</span><span class='line'><span class="o">+</span> <span class="mi">111</span>
</span><span class='line'><span class="o">------</span>
</span><span class='line'>  <span class="mi">434</span>
</span><span class='line'><span class="sx">%  </span> <span class="mi">3</span>
</span><span class='line'><span class="o">------</span>
</span><span class='line'>  <span class="mi">101</span>
</span></code></pre></td></tr></table></div></figure>


<p>但愿这坨东西能让人看懂</p>

<p>via: <a href="http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/BitOp/xor.html">http://www.cs.umd.edu/class/sum2003/cmsc311/Notes/BitOp/xor.html</a></p>

<h2>没有<code>^</code>操作时候实现异或，只用<code>&amp;</code>与 <code>|</code>或 <code>~</code>非</h2>

<p>这里的转换有很多，比如下面这个</p>

<p><code>x ^ y == (~x &amp; y) | (x &amp; ~y)</code></p>

<p>具体查看<a href="http://en.wikipedia.org/wiki/Exclusive_or">维基百科</a> 《Equivalencies, elimination, and introduction》部分，各种公式</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-13T12:36:00+08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/optimized-png-in-xcode/">
		
			Xcode优化过的PNG</a>
	</h2>
	<div class="entry-content">
		<p>开始做iOS应用就有一个“公理”，<strong>图片素材要使用png格式</strong>，至于公理是怎么形成的完全不知道，只是听说在官方文档里提到过一句：苹果会对png进行优化。</p>

<p>为什么优化？谁优化的？什么时候优化的？怎么优化的？</p>

<p>和所有的魔术一样，说穿了就不好玩了。一切的根源是iPhone的显存。iPhone的vRAM在存放单个像素的颜色的时候，并不是按照传统的“红-绿-蓝”这样的顺序排列的，而是“蓝-绿-红”，即我们常说的RGB，在iPhone的显存里是BGR。并且，没有alpha通道。</p>

<p>另一边，png格式按照“红-绿-蓝”的顺序描述颜色，并且支持alpha通道的半透明，RGBA四个通道各占1个字节。</p>

<ul>
<li>为什么优化？
因为一边RGB一边BGR，一边有alpha一边没有alpha。</li>
<li>谁优化的？
文章标题已经剧透了，Xcode优化的。</li>
<li>什么时候优化的？
Xcode在编译时，会对png资源进行优化。</li>
<li>怎么优化的？
优化做了两件事：

<ol>
<li>把png里所有的RGB颜色转成BGR顺序</li>
<li>把png里所有的alpha通道先和RGB三通道先乘好（比如R:1 G:1 B:1 A:0.5的颜色直接转成 R:0.5 G:0.5 B:0.5）</li>
</ol>
</li>
</ul>


<p>这样最终设备在运行时渲染这些颜色的时候，不需要任何处理，一个汇编语句就把数据丢尽显存里了。</p>

<p>PS: <a href="http://developer.apple.com/library/ios/#qa/qa1681/_index.html">这里</a>还有一个手动转换，和还原的办法</p>

<p>via: <a href="http://iphonedevelopment.blogspot.jp/2008/10/iphone-optimized-pngs.html">http://iphonedevelopment.blogspot.jp/2008/10/iphone-optimized-pngs.html</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-12T00:07:00+08:00" pubdate data-updated="true">Dec 12<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programing/'>Programing</a>


</div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/migrated-from-wordpress-to-octopress/">
		
			从wordpress搬到octopress</a>
	</h2>
	<div class="entry-content">
		<p>断断续续把wordpress转换到octopress上了。这是z-blog转到wordpress之后第二次更换博客系统了，octopress很酷，markdown的数据复用、搬家、存档都比lamp的wordpress轻便的多。</p>

<p>从导出wordpress数据库，转换为markdown，部署到github，搬图片文件，转换评论，磨磨蹭蹭的前前后后大约拖延了有两周，到今天终于把域名解析给换到这里来了。</p>

<p>最头疼的是转换文章的脚本不见得可靠，老文章的格式乱七八糟需要一篇一篇手动去修正，我现在做了一半，至少保证最新的大约3/5的文章是修改过的友好的格式。</p>

<p>很久没有更新博客，evernote的博客素材已经攒了一大堆，有空一篇一篇写出来吧。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-12-11T23:12:00+08:00" pubdate data-updated="true">Dec 11<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>Life</a>


</div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Arthur Wang

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'artorius';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-8352384-7']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>