
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Z-blog 1.8 Arwen Build 90619 换行符问题的解决 - Artoirus</title>
  <meta name="author" content="Arthur Wang">

  
  <meta name="description" content="在7月20日后知后觉的将Z-BLOG从build 81206 升级到 build 90619 之后，就没有正儿八经的贴过代码了。以至于10多天都没有发现我的Z-BLOG已经有了细微上的变化。昨天Arthur贴一些简单的C#代码的时候，才发现pre标签里的换行都不会被记录了。百思不得其解， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Arthraim.github.com/blog/2009/08/07/solve-z-blog-1-8-arwen-build-90619-br-character/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Artoirus" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Artoirus</a></h1>
  
    <h2>Arthur Wang's blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Arthraim.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Z-blog 1.8 Arwen Build 90619 换行符问题的解决</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-07T09:38:22+08:00" pubdate data-updated="true">Aug 7<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>在7月20日后知后觉的将Z-BLOG从build 81206 升级到 build 90619 之后，就没有正儿八经的贴过代码了。以至于10多天都没有发现我的Z-BLOG已经有了细微上的变化。昨天Arthur贴一些简单的C#代码的时候，才发现pre标签里的换行都不会被记录了。百思不得其解，并且四处求助。最后求人不如求己，夜深人静的时候总是喜欢维护下博客，所以刚才解决了这个问题。详细看看我问题的发现和解决过程。</p>

<p><strong>问题发现：</strong></p>

<p>Arthur在后台是使用了Z-BLOG默认的FCKeditor来编辑文字的，应该说是非常习惯的，尤其是比较偷懒的每次使用lightbox都直接把代码贴进文章区域里，所以经常在所见即所得和源代码之间切换编辑。可是在昨天写上一篇文章《<a href="http://arthraim.cn/post/2009/08/90.html">C#随机顺序输出数字 1～9 的算法</a>》的时候，突然发现，UBB中贴好的代码在保存草稿之后就大变样了。其实这个问题在之前贴《<a href="http://arthraim.cn/post/2009/07/86.html">世界编程大赛第一名的3D程序</a>》文中的大规模代码的时候就已经发现，只是因为那些DEX也的确没有高亮的必要，所以后来采用了其他的方式。而昨天注定要使用高亮的时候也遇到了这个问题，Arthur就感到十分的困惑了。</p>

<p>进一步的发现是，我找到了以前的一些文章，比如<a href="http://arthraim.cn/post/2009/07/81.html">XNA的教程</a>，这好几十篇的文章都是有很多代码的。结果情况非常可怕，所有的这些代码也都是乱乱的。看着Google Anlytics上面的访问量和搜索引擎统计我就心急，难道大家通过搜索引擎过来看见的就是这样的乱七八糟的代码（没有换行）？</p>

<p>之后我找到了升级博客系统前的数据库备份，找到了文章的字段的内容。将其贴出来之后发现所有的文章都是有换行信息的。于是我再重新检查当前的数据库，发现升级之前的文章的换行符也都是存在的，只是新写的文章看来是都没有了。并且老文章生成的HTML页面，那些换行符也是没有了。</p>

<p>最终可以把问题归结成2个。</p>

<ol>
<li><p>FCKeditor 存取数据库时去除了换行符。</p></li>
<li><p>文章重建，也就是通过UBB生成html 静态页面的时候去除了换行符。</p></li>
</ol>


<p><strong>问题解决：</strong></p>

<p>在找到问题所在之后，Arthur开始寻找解决办法。解决第一个问题，就要看FCKeditor 的问题。找了一些资料，记得在以前找代码高亮方案的时候看到过相关的笔记，于是找出当时存的网页，看了下。果然，问题找到了。</p>

<p>Build 81206 的版本要插入pre，必须要注释掉去除换行符的代码。我当时找到这两行代码的时候发现其实已经注释掉了。这么说在这一版本中已经默认了保留换行符。而在Build 90619中，这部分代码又没有被注释了，不知出于什么原因又将策略改了回去。那么只要重新注释掉，就能解决FCKeditor存取的问题了。</p>

<p>罪魁祸首就是下面的代码。function/c_system _event.asp 文件中的第298行。这四行分别控制了文章内容(Content)和摘要(Intro)CR,LF，LF的替换。可见都被替换成了&#8221;&#8220;。注释掉自己需要的就可以。我只是注释了298这一行，足矣。</p>

<pre><code>objArticle.Content=Replace(objArticle.Content,vbCrLf,"")
objArticle.Content=Replace(objArticle.Content,vbLf,"")
objArticle.Intro=Replace(objArticle.Intro,vbCrLf,"")
objArticle.Intro=Replace(objArticle.Intro,vbLf,"")
</code></pre>

<p>的另外，联系c_system_event.asp上下文可以看到，这只是CASE &#8220;fckeditor&#8221;，如果你没有使用这个默认的编辑器，那么把其他的case也都改掉吧。</p>

<p>很好，解决问题1之后，重建文章还是没有效果的，因为还有问题2困扰在这里。其实Arthur并不清楚Z-blog的代码是怎么组织的，所以生成HTML的代码究竟在哪里我也不知道，毕竟我也不是开发人员只是个使用者。跑去Z-blog的官方网站的wiki，看<a href="http://wiki.rainbowsoft.org/doku.php?id=wiki:changelog">更新日志</a>缩小范围。</p>

<p><a href="/upload/2009-08-07_update.jpg"><img src="/upload/2009-08-07_update.jpg" alt="" /></a></p>

<p>哈哈，更新不多，涉及修改的也就是function/c_system_lib.asp了。把它找出来，代码量很庞大，没关系，打开 UltraEdit 的文件比对，和之前本地没有升级的文件比较比较。轻松愉快的发现了位置所在，392行。</p>

<pre><code>Public Property Get HtmlContent
HtmlContent=TransferHTML(UBBCode(Content,"[face][link][email][autolink][font][code][image][typeset][media][flash][key]"),"[html-japan][vbCrlf][upload]")
End Property
</code></pre>

<p>恩，这里的代码也被加回来了，悄悄的把[vbCrlf]去掉。文件重建后就大功告成啦～</p>

<p><strong>小小小总结：</strong></p>

<p>面对不是自己开发的东西的版本更新带来的问题，要这样解决也是蛮辛苦的，好在WEB程序还是相对自由一点，倘若其他的桌面应用拿过来就痛苦多了（不过反汇编软件也很多很高级）。之前还求助交流论坛，还求助开发人员（虽然没有得到回复），不过好在夜深人静的时候把它解决了。</p>

<p>由此我联想到，笔记桌面应用来说，更加难以解决版本更新带来的问题（不能自己解决，只能等开发者下一个版本的更新）在web3.0时代就将更加常见了。上一次youtube引发的网民不买账事件我觉得应该可以载入史册了。当然也许web应用版本更新带来用户不接受的例子不是第一个，不过应该是足够有分量的一个了。未来是不是只能看着别人脸色过日子了。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Arthur Wang</span></span>

      








  


<time datetime="2009-08-07T09:38:22+08:00" pubdate data-updated="true">Aug 7<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/programing/'>Programing</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://Arthraim.github.com/blog/2009/08/07/solve-z-blog-1-8-arwen-build-90619-br-character/" data-via="" data-counturl="http://Arthraim.github.com/blog/2009/08/07/solve-z-blog-1-8-arwen-build-90619-br-character/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2009/08/06/algorithm-of-randomly-output-nine-numbers/" title="Previous Post: C#随机顺序输出数字 1～9 的算法">&laquo; C#随机顺序输出数字 1～9 的算法</a>
      
      
        <a class="basic-alignment right" href="/blog/2009/08/11/facebook-got-a-new-friend-friendfeed/" title="Next Post: Facebook 收购新朋友： FriendFeed">Facebook 收购新朋友： FriendFeed &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/06/08/euro-2012-google-calendar-or-outlook-calendar/">2012欧洲杯Google,iCal,Outlook日历</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/02/git-prune-branch/">git修剪分支</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/13/mac-os-10-7-3-breaks-xcode-binary-validation/">Mac OS 10.7.3用xcode提交二进制文件验证失败</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/06/abandon-arthraim-cn/">停用arthraim.cn域名</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/01/arthur-s-2011-summary/">Arthur的2011年总结</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Arthur Wang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
